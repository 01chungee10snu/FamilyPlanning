<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>가족계획: 미완의 과제 - 통합 발표자료</title>

    <!-- Seoul Fonts CDN -->
    <link href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulHangang.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulNamsan.css" rel="stylesheet">

    <!-- External Libraries CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1"></script>

    <!-- PDF Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* ==================== 기본 설정 ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Seoul 폰트 적용 및 Weight 정의 */
        @font-face {
            font-family: 'SeoulHangang';
            font-weight: 200;
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulHangangL.woff') format('woff');
        }

        @font-face {
            font-family: 'SeoulHangang';
            font-weight: 300;
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulHangangL.woff') format('woff');
        }

        @font-face {
            font-family: 'SeoulHangang';
            font-weight: 500;
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulHangangM.woff') format('woff');
        }

        @font-face {
            font-family: 'SeoulHangang';
            font-weight: 700;
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulHangangB.woff') format('woff');
        }

        @font-face {
            font-family: 'SeoulHangang';
            font-weight: 800;
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulHangangEB.woff') format('woff');
        }

        @font-face {
            font-family: 'SeoulNamsan';
            font-weight: 300;
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulNamsanL.woff') format('woff');
        }

        @font-face {
            font-family: 'SeoulNamsan';
            font-weight: 500;
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulNamsanM.woff') format('woff');
        }

        @font-face {
            font-family: 'SeoulNamsan';
            font-weight: 700;
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulNamsanB.woff') format('woff');
        }

        @font-face {
            font-family: 'SeoulNamsan';
            font-weight: 800;
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulNamsanEB.woff') format('woff');
        }

        body {
            font-family: 'SeoulNamsan', 'Malgun Gothic', sans-serif;
            font-weight: 300;
            background: linear-gradient(135deg, var(--primary-green-dark) 0%, var(--primary-green) 100%);
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        /* Color Concept Palette - Warm tones from ColorConcept.png */
        :root {
            /* Primary Colors */
            --primary-green-dark: #2d5931;    /* Dark green */
            --primary-green: #4a7c4e;         /* Medium green */
            --primary-green-light: #6b9f6e;   /* Light green */

            /* Secondary Colors */
            --secondary-brown-dark: #8b4513;  /* Dark brown */
            --secondary-brown: #a0522d;       /* Medium brown */
            --secondary-brown-light: #cd853f; /* Light brown */

            /* Accent Colors */
            --accent-yellow: #ffd700;         /* Gold yellow */
            --accent-yellow-light: #ffed4e;   /* Light yellow */
            --accent-beige: #f5f5dc;          /* Beige */

            /* Text Colors */
            --text-primary: #2d5931;          /* Dark green for main text */
            --text-secondary: #4a7c4e;        /* Medium green for secondary */
            --text-light: #6b6b6b;            /* Gray for light text */

            /* Background Colors */
            --bg-light: #faf8f3;               /* Light warm background */
            --bg-medium: #f5f0e8;              /* Medium warm background */
            --bg-dark: #e8e2d5;               /* Dark warm background */

            /* Chart Colors */
            --chart-1: #2d5931;
            --chart-2: #4a7c4e;
            --chart-3: #8b4513;
            --chart-4: #daa520;
            --chart-5: #cd853f;
            --chart-6: #6b9f6e;
        }

        /* ==================== 16:9 비율 강제 ==================== */
        .presentation-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }

        .presentation-viewport {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: calc(100vh * 16 / 9);
            max-height: calc(100vw * 9 / 16);
            background: #fff;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        /* ==================== 슬라이드 기본 스타일 ==================== */
        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
            padding: 40px 60px;
            background: linear-gradient(135deg, #ffffff 0%, var(--accent-beige) 100%);
            overflow: hidden;
        }

        .slide.active {
            display: flex;
            flex-direction: column;
        }

        /* ==================== Typography ==================== */
        h1 {
            font-family: 'SeoulHangang', sans-serif;
            font-weight: 800;
            font-size: 48px;
            color: var(--text-primary);
            line-height: 1.2;
            margin-bottom: 25px;
        }

        h2 {
            font-family: 'SeoulHangang', sans-serif;
            font-weight: 700;
            font-size: 36px;
            color: var(--primary-green-dark);
            margin-bottom: 20px;
        }

        h3 {
            font-family: 'SeoulHangang', sans-serif;
            font-weight: 500;
            font-size: 28px;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        h4 {
            font-family: 'SeoulNamsan', sans-serif;
            font-weight: 700;
            font-size: 22px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        p {
            font-family: 'SeoulNamsan', sans-serif;
            font-weight: 300;
            font-size: 20px;
            line-height: 1.7;
            color: var(--text-primary);
        }

        strong, b {
            font-family: 'SeoulNamsan', sans-serif;
            font-weight: 700;
        }

        /* ==================== 레이아웃 ==================== */
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            height: calc(100% - 60px);
        }

        .three-column {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            height: calc(100% - 60px);
        }

        .main-with-side {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            height: calc(100% - 60px);
        }

        /* ==================== List Styles ==================== */
        ul, ol {
            padding-left: 0;
            list-style: none;
        }

        li {
            font-family: 'SeoulNamsan', sans-serif;
            font-weight: 300;
            font-size: 20px;
            line-height: 1.8;
            color: var(--text-primary);
            margin: 8px 0;
            position: relative;
            padding-left: 28px;
        }

        li:before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--primary-green);
            font-weight: 700;
            font-size: 24px;
            line-height: 1.4;
        }

        /* ==================== 컴포넌트 스타일 ====================*/
        .panel-box {
            background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-medium) 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 12px 0;
            border-left: 4px solid var(--primary-green);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .data-card {
            background: white;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .data-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-family: 'SeoulHangang', sans-serif;
            font-weight: 800;
            font-size: 48px;
            color: #69b7a4;
            margin: 8px 0;
        }

        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
            margin: 10px 0;
        }

        .small-chart {
            height: 180px;
        }

        .map-container {
            position: relative;
            height: 100%;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
        }

        /* Crisis Slide Styles */
        .crisis-slide {
            background: var(--bg-medium);
        }

        .crisis-slide h1 {
            color: var(--text-primary);
            font-size: 48px;
            margin-bottom: 15px;
        }

        .crisis-slide .subtitle {
            color: var(--text-secondary);
            font-size: 26px;
            margin-bottom: 30px;
        }

        .crisis-panels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            height: calc(100% - 180px);
            padding: 0 20px;
        }

        .crisis-panel {
            padding: 25px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .panel-funding {
            background: linear-gradient(135deg, var(--primary-green-light) 0%, var(--primary-green) 100%);
            border: 3px solid var(--primary-green-dark);
        }

        .panel-africa {
            background: linear-gradient(135deg, var(--secondary-brown-light) 0%, var(--secondary-brown) 100%);
            border: 3px solid var(--secondary-brown-dark);
        }

        .panel-resource {
            background: linear-gradient(135deg, var(--accent-beige) 0%, var(--accent-yellow-light) 100%);
            border: 3px solid var(--accent-yellow);
        }

        .panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .panel-icon {
            font-size: 36px;
            margin-right: 15px;
        }

        .panel-header h3 {
            color: var(--text-primary);
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }

        .key-metric {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }

        .metric-value {
            font-size: 52px;
            font-weight: 800;
            color: var(--text-primary);
        }

        .metric-label {
            font-size: 20px;
            color: var(--text-secondary);
            text-align: center;
            font-weight: 500;
        }

        .crisis-panel canvas {
            width: 100%;
            height: 150px;
            margin: 10px 0;
        }

        #africaCrisisMap {
            width: 100%;
            height: 240px;
            margin: 15px 0;
            border-radius: 8px;
            border: 2px solid #8B6F47;
            box-shadow: 0 2px 8px rgba(139, 111, 71, 0.3);
        }

        .panel-points {
            list-style: none;
            padding: 0;
            margin: 10px 0 0;
        }

        .panel-points li {
            color: #000000;
            font-size: 17px;
            margin: 10px 0;
            padding-left: 24px;
            position: relative;
            font-weight: 500;
            line-height: 1.6;
        }

        .panel-points li:before {
            content: "▸";
            position: absolute;
            left: 0;
            color: #2D5F5D;
            font-weight: bold;
            font-size: 18px;
        }

        .citation-footer {
            position: absolute;
            bottom: 20px;
            right: 40px;
            color: #000000;
            font-size: 16px;
            font-style: italic;
            font-weight: 500;
        }

        /* 테이블 */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 20px;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .data-table th {
            font-family: 'SeoulHangang', sans-serif;
            font-weight: 700;
            background: var(--primary-green);
            color: white;
            padding: 12px;
            text-align: left;
            font-size: 20px;
        }

        .data-table td {
            font-family: 'SeoulNamsan', sans-serif;
            font-weight: 300;
            padding: 10px 12px;
            border-bottom: 1px solid var(--bg-dark);
            background: var(--bg-light);
            color: var(--text-primary);
            font-size: 19px;
        }

        /* 인용문 */
        .quote-box {
            position: relative;
            padding: 25px 30px;
            background: linear-gradient(135deg, var(--accent-beige) 0%, var(--bg-medium) 100%);
            border-left: 5px solid var(--secondary-brown);
            border-radius: 12px;
            margin: 20px 0;
            font-style: italic;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .quote-box p {
            font-size: 22px;
            color: var(--text-primary);
            font-weight: 400;
            margin: 0;
        }

        /* ==================== 지도 툴팁 스타일 ==================== */
        .map-tooltip {
            font-family: 'SeoulNamsan', sans-serif;
            background: rgba(255, 255, 255, 0.98);
            border: 2px solid #69b7a4;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            min-width: 200px;
        }

        .map-tooltip h4 {
            font-family: 'SeoulHangang', sans-serif;
            font-weight: 700;
            font-size: 20px;
            color: #2d3748;
            margin: 0 0 8px 0;
            padding-bottom: 6px;
            border-bottom: 1px solid #e2e8f0;
        }

        .tooltip-stat {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 19px;
        }

        .tooltip-label {
            font-weight: 500;
            color: #718096;
        }

        .tooltip-value {
            font-family: 'SeoulHangang', sans-serif;
            font-weight: 700;
            color: #69b7a4;
        }

        .tooltip-trend {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e2e8f0;
            font-size: 18px;
            font-style: italic;
        }

        .trend-positive { color: #69b7a4; }
        .trend-negative { color: #c97064; }
        .trend-neutral { color: #718096; }

        /* ==================== UI 컨트롤 숨김 ==================== */
        .nav-controls, .timer-display, .progress-bar, .slide-number {
            display: none !important;
        }

        /* ==================== 페이지 카운터 ==================== */
        .page-counter {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-family: 'SeoulHangang', sans-serif;
            font-weight: 700;
            font-size: 24px;
            color: #2d3a3a;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        /* ==================== PDF 내보내기 ==================== */
        .pdf-export-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(59, 130, 246, 0.3);
            z-index: 1000;
            transition: all 0.3s;
            font-family: 'SeoulNamsan', sans-serif;
            display: none; /* 버튼 숨기기 */
        }

        .pdf-export-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .pdf-export-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .pdf-progress {
            position: fixed;
            top: 70px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
            z-index: 1001;
            min-width: 250px;
            font-family: 'SeoulNamsan', sans-serif;
        }

        .pdf-progress.active {
            display: block;
        }

        .pdf-progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .pdf-progress-fill {
            height: 100%;
            background: #3b82f6;
            border-radius: 4px;
            transition: width 0.3s;
            width: 0%;
        }

        /* ==================== 타이틀 슬라이드 ==================== */
        .title-slide {
            background: linear-gradient(135deg, #576066 0%, #3e4948 100%);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .title-slide h1 {
            font-size: 64px;
            color: #FFFFFF !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .title-slide p {
            color: #FFFFFF !important;
        }

        .title-slide h4 {
            color: #FFFFFF !important;
        }

        .key-messages {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 30px;
            width: 80%;
        }

        .key-message {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .key-message h4, .key-message p {
            color: #FFFFFF !important;
        }

        .key-message h4 {
            color: white;
            margin-bottom: 5px;
        }

        .key-message p {
            color: rgba(255,255,255,0.9);
            font-size: 18px;
        }

        /* ==================== 반응형 조정 ==================== */
        @media (max-width: 1200px) {
            h1 { font-size: 42px; }
            h2 { font-size: 42px; }
            h3 { font-size: 18px; }
            p { font-size: 19px; }
            .slide { padding: 30px 40px; }
        }
    </style>
</head>
<body>
    <!-- PDF 내보내기 버튼 -->
    <button class="pdf-export-btn" onclick="exportToPDF()">PDF로 저장</button>

    <!-- PDF 진행 상태 -->
    <div class="pdf-progress" id="pdfProgress">
        <div>PDF 생성 중...</div>
        <div id="pdfProgressText">준비 중...</div>
        <div class="pdf-progress-bar">
            <div class="pdf-progress-fill" id="pdfProgressFill"></div>
        </div>
    </div>

    <div class="presentation-container">
        <div class="presentation-viewport">

            <!-- Slide 1: 타이틀 + 핵심 메시지 -->
            <div class="slide title-slide active">
                <h1>가족계획: 미완의 과제</h1>
                <p style="font-size: 48px; margin-bottom: 30px; color: var(--primary-green-dark);">
                    Family planning: The unfinished agenda
                </p>
                <div class="key-messages">
                    <div class="key-message">
                        <h4>보건 향상</h4>
                        <p>모성·영아 사망률 감소</p>
                    </div>
                    <div class="key-message">
                        <h4>경제 발전</h4>
                        <p>빈곤 감소와 성장 촉진</p>
                    </div>
                    <div class="key-message">
                        <h4>여성 권한</h4>
                        <p>교육·경제 참여 확대</p>
                    </div>
                    <div class="key-message">
                        <h4>지속가능성</h4>
                        <p>인구·환경 균형</p>
                    </div>
                </div>
                <p style="margin-top: 40px; font-size: 24px; color: #FFFFFF;">
                    Family planning: the unfinished agenda. The Lancet, 368(9549), 1810-1827.
                </p>
            </div>

            <!-- Slide 2: 역사적 맥락 -->
            <div class="slide">
                <h1>가족계획의 역사적 전환점</h1>
                <div class="two-column">
                    <div>
                        <div class="panel-box">
                            <h3>1960년대: 시작</h3>
                            <p><strong>인구 폭발 우려</strong></p>
                            <ul style="font-size: 20px; margin: 10px 0; padding-left: 20px; list-style: none;">
                                <li style="margin: 8px 0;">• 개발도상국 급속 인구 증가</li>
                                <li style="margin: 8px 0;">• 경제발전 저해 우려</li>
                                <li style="margin: 8px 0;">• 정부 주도 프로그램 시작</li>
                            </ul>
                        </div>
                        <div class="panel-box" style="background: linear-gradient(135deg, #fef5e7 0%, #fdebd0 100%);">
                            <h3>1994년: 카이로 회의</h3>
                            <p><strong>패러다임 전환</strong></p>
                            <ul style="font-size: 20px; margin: 10px 0; padding-left: 20px; list-style: none;">
                                <li style="margin: 8px 0;">• 인구 목표 → 개인 권리</li>
                                <li style="margin: 8px 0;">• 숫자 중심 → 인권 중심</li>
                                <li style="margin: 8px 0;">• 여성 생식건강권 강조</li>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <h3>주요 성과와 도전</h3>
                        <div class="chart-container">
                            <canvas id="historicalTrend"></canvas>
                        </div>
                        <div class="data-card" style="margin-top: 15px;">
                            <p style="font-size: 19px;">전 세계 피임 사용률</p>
                            <div class="stat-number">10% → 60%</div>
                            <p style="font-size: 18px; color: #718096;">1960 → 2005</p>
                            <p style="font-size: 16px; color: #c97064; margin-top: 10px; font-style: italic;">
                                ※ 2025년 현황: 65% (현대적 방법 59%) (UN, 2024)
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 3: 글로벌 인구 현황 (지도 포함) -->
            <div class="slide">
                <h1>글로벌 인구 동향과 지역별 현황</h1>
                <div class="main-with-side">
                    <div>
                        <div class="map-container" id="worldMap" style="height: 350px;"></div>
                        <div style="display: flex; gap: 15px; margin-top: 15px;">
                            <div class="data-card" style="flex: 1;">
                                <p>1960년</p>
                                <div class="stat-number" style="font-size: 36px;">30.2억</div>
                            </div>
                            <div class="data-card" style="flex: 1;">
                                <p>2005년</p>
                                <div class="stat-number" style="font-size: 36px;">64.6억</div>
                            </div>
                            <div class="data-card" style="flex: 1;">
                                <p>2050년 예측</p>
                                <div class="stat-number" style="font-size: 36px;">90.8억</div>
                            </div>
                        </div>
                        <p style="font-size: 16px; color: #c97064; margin-top: 10px; font-style: italic; text-align: center;">
                            ※ 2025년 현황: 세계 TFR 2.3 (UN, 2024)
                        </p>
                    </div>
                    <div>
                        <h3>지역별 인구 (Table 1)</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>지역</th>
                                    <th>1960</th>
                                    <th>2005</th>
                                    <th>2050</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background: #f0f9ff;">
                                    <td><strong>세계 전체</strong></td>
                                    <td>3,019M</td>
                                    <td>6,464M</td>
                                    <td>9,075M</td>
                                </tr>
                                <tr>
                                    <td>선진국</td>
                                    <td>916M</td>
                                    <td>1,211M</td>
                                    <td>1,236M</td>
                                </tr>
                                <tr>
                                    <td>개발도상국</td>
                                    <td>2,104M</td>
                                    <td>5,253M</td>
                                    <td>7,839M</td>
                                </tr>
                                <tr style="background: #fafafa;">
                                    <td colspan="4" style="font-weight: 600; padding: 8px;">대륙별</td>
                                </tr>
                                <tr>
                                    <td>아프리카</td>
                                    <td>283M</td>
                                    <td>906M</td>
                                    <td>1,937M</td>
                                </tr>
                                <tr>
                                    <td>아시아</td>
                                    <td>1,699M</td>
                                    <td>3,905M</td>
                                    <td>5,217M</td>
                                </tr>
                                <tr>
                                    <td>유럽</td>
                                    <td>604M</td>
                                    <td>728M</td>
                                    <td>653M</td>
                                </tr>
                                <tr>
                                    <td>라틴아메리카/카리브</td>
                                    <td>221M</td>
                                    <td>561M</td>
                                    <td>783M</td>
                                </tr>
                                <tr>
                                    <td>북아메리카</td>
                                    <td>204M</td>
                                    <td>329M</td>
                                    <td>438M</td>
                                </tr>
                                <tr>
                                    <td>오세아니아</td>
                                    <td>16M</td>
                                    <td>33M</td>
                                    <td>48M</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="panel-box" style="margin-top: 15px;">
                            <h4>핵심 인사이트</h4>
                            <p style="font-size: 18px;">
                                <span style="margin-left: 20px;">• 전체 증가분의 <strong>95%</strong>가 개발도상국에서 발생</span><br>
                                <span style="margin-left: 20px;">• 아프리카 인구 <strong>2.1배</strong> 증가 예상 (906M→1,937M)</span><br>
                                <span style="margin-left: 20px;">• 유럽은 유일하게 <strong>인구 감소</strong> 예상 (728M→653M)</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 4: 니제르 사례 -->
            <div class="slide">
                <h1>사하라이남 아프리카: 니제르 위기</h1>
                <div class="two-column">
                    <div>
                        <div id="nigerMap" class="map-container" style="height: 280px;"></div>
                        <div class="panel-box" style="margin-top: 15px; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);">
                            <h3>니제르 현황</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <p style="font-size: 16px; color: #718096;">합계출산율 (1998)</p>
                                    <p style="font-size: 42px; font-weight: 800; color: #dc2626;">7.5명</p>
                                </div>
                                <div>
                                    <p style="font-size: 16px; color: #718096;">피임 사용률</p>
                                    <p style="font-size: 42px; font-weight: 800; color: #dc2626;">4.6%</p>
                                </div>
                                <div>
                                    <p style="font-size: 16px; color: #718096;">인구 증가율</p>
                                    <p style="font-size: 42px; font-weight: 800; color: #dc2626;">3.3%/년</p>
                                </div>
                                <div>
                                    <p style="font-size: 16px; color: #718096;">2050년 예측</p>
                                    <p style="font-size: 42px; font-weight: 800; color: #dc2626;">5,000만명</p><!-- Corrected from <5천만 to 5,000만 per Table 2 -->
                                </div>
                                <div>
                                    <p style="font-size: 16px; color: #718096;">현재 인구 (2005)</p>
                                    <p style="font-size: 42px; font-weight: 800; color: #dc2626;">1,400만명</p><!-- Corrected from 1,250만 to 1,400만 per Table 2 -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3>도전과 결과</h3>
                        <div class="quote-box">
                            <p>"현재 추세 지속 시 2050년까지 인구 4배 증가, 식량 안보와 환경 지속가능성 위협"</p>
                        </div>
                        <h4>주요 장애요인</h4>
                        <ul style="font-size: 19px; line-height: 1.8;">
                            <li>👥 <strong>문화적 요인</strong>: 대가족 선호, 조혼 관습</li>
                            <li>🏥 <strong>서비스 접근성</strong>: 농촌 지역 의료 시설 부족</li>
                            <li>📚 <strong>교육 부족</strong>: 여성 문해율 15% 미만</li>
                            <li>💰 <strong>경제적 제약</strong>: 피임 비용 부담</li>
                            <li>⚖️ <strong>성 불평등</strong>: 여성 의사결정권 제한</li>
                        </ul>
                        <div class="data-card" style="background: #fef3c7; margin-top: 15px;">
                            <h4 style="color: #92400e;">긴급 대응 필요</h4>
                            <p style="font-size: 18px;">
                                통합적 접근: 교육 + 보건 + 여성권한 + 경제개발
                            </p>
                            <p style="font-size: 16px; color: #c97064; margin-top: 10px; font-style: italic;">
                                ※ 2025년 현황: Niger TFR 6.7명 (세계 최고), 피임률 17% (UN, 2024)
                            </p>
                        </div>
                        <!-- 니제르 국가 정보 추가 -->
                        <div style="background: linear-gradient(135deg, #fff7ed, #fed7aa); padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #ea580c;">
                            <h4 style="color: #7c2d12; margin-bottom: 10px;">니제르의 지리적 제약</h4>
                            <p style="font-size: 14px; color: #92400e; line-height: 1.6;">
                                니제르는 국토의 <strong>80% 이상이 사하라 사막</strong>으로 덮여있으며, 인구의 대부분이 남부 지역에 집중되어 있음.
                                경작 가능한 토지는 전체 면적의 <strong>14%</strong>에 불과하며 (World Bank, 2022),
                                인구는 수도 니아메이를 포함한 남서부 지역에 밀집.
                                북부 사막 지역은 오아시스를 제외하고 거의 무인지대임 (CIA World Factbook, 2024).
                            </p>
                            <p style="font-size: 12px; color: #713f12; font-style: italic; margin-top: 8px;">
                                <strong>Sources:</strong> World Bank (2022); CIA (2024)
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 5: 통합된 성공/실패 사례 -->
            <div class="slide">
                <h1>가족계획 성공과 실패: 국가별 비교</h1>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; height: 85%;">
                    <!-- 왼쪽: 성공 사례들 -->
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <h3 style="text-align: center; margin: 5px 0;">✅ 성공 사례</h3>

                        <!-- 케냐 -->
                        <div class="panel-box" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); flex: 1;">
                            <h4 style="margin: 5px 0;">🇰🇪 케냐: 정부 주도</h4>
                            <div style="display: flex; gap: 10px; margin: 5px 0;">
                                <div style="flex: 1; text-align: center;">
                                    <span style="font-size: 14px;">TFR</span><br>
                                    <strong style="color: #059669;">8.0→4.8</strong>
                                </div>
                                <div style="flex: 1; text-align: center;">
                                    <span style="font-size: 14px;">피임률</span><br>
                                    <strong style="color: #059669;">7→27%</strong>
                                </div>
                            </div>
                            <p style="font-size: 14px; margin: 5px 0;">
                                • 강력한 정치적 의지<br>
                                • 지역사회 기반 프로그램
                            </p>
                        </div>

                        <!-- 브라질 -->
                        <div class="panel-box" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); flex: 1;">
                            <h4 style="margin: 5px 0;">🇧🇷 브라질: 사회 주도</h4>
                            <div style="display: flex; gap: 10px; margin: 5px 0;">
                                <div style="flex: 1; text-align: center;">
                                    <span style="font-size: 14px;">TFR</span><br>
                                    <strong style="color: #2563eb;">6.2→2.5</strong>
                                </div>
                                <div style="flex: 1; text-align: center;">
                                    <span style="font-size: 14px;">피임률</span><br>
                                    <strong style="color: #2563eb;">77%</strong>
                                </div>
                            </div>
                            <p style="font-size: 14px; margin: 5px 0;">
                                • 미디어 영향 (TV 노벨라)<br>
                                • 여성 교육 확대
                            </p>
                        </div>

                        <!-- 방글라데시 -->
                        <div class="panel-box" style="background: linear-gradient(135deg, #e5f5e0 0%, #c8e6c9 100%); flex: 1;">
                            <h4 style="margin: 5px 0;">🇧🇩 방글라데시: 혁신적 접근</h4>
                            <div style="display: flex; gap: 10px; margin: 5px 0;">
                                <div style="flex: 1; text-align: center;">
                                    <span style="font-size: 14px;">TFR</span><br>
                                    <strong style="color: #16a34a;">6.3→3.0</strong>
                                </div>
                                <div style="flex: 1; text-align: center;">
                                    <span style="font-size: 14px;">피임률</span><br>
                                    <strong style="color: #16a34a;">58%</strong>
                                </div>
                            </div>
                            <p style="font-size: 14px; margin: 5px 0;">
                                • 여성 지역보건요원<br>
                                • 문맹 여성 프로그램<br>
                                • 소액금융 연계
                            </p>
                        </div>
                    </div>

                    <!-- 오른쪽: 실패/정체 사례 및 차트 -->
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <h3 style="text-align: center; margin: 5px 0;">❌ 정체/실패 사례</h3>

                        <!-- 파키스탄 -->
                        <div class="panel-box" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">
                            <h4 style="margin: 5px 0;">🇵🇰 파키스탄: 정체 상태</h4>
                            <div style="display: flex; gap: 10px; margin: 5px 0;">
                                <div style="flex: 1; text-align: center;">
                                    <span style="font-size: 14px;">TFR</span><br>
                                    <strong style="color: #ea580c;">6.0→4.3</strong>
                                </div>
                                <div style="flex: 1; text-align: center;">
                                    <span style="font-size: 14px;">피임률</span><br>
                                    <strong style="color: #ea580c;">12%</strong>
                                </div>
                            </div>
                            <p style="font-size: 14px; margin: 5px 0;">
                                • 정치적 불안정<br>
                                • 종교적 반대<br>
                                • 여성 이동 제한
                            </p>
                        </div>

                        <!-- 비교 차트 -->
                        <div style="flex: 1; background: white; border-radius: 8px; padding: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 5px 0; text-align: center;">남아시아 TFR 비교</h4>
                            <div class="chart-container" style="height: 200px;">
                                <canvas id="southAsiaComparison"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <p style="text-align: center; font-size: 14px; margin-top: 10px; font-style: italic;">
                    <span style="color: #c97064;">※ 2025년 현황: 방글라데시 TFR 1.9, 파키스탄 TFR 3.2 (UNFPA, 2024)</span>
                </p>
            </div>

            <!-- Slide 6: 위기의 가족계획 -->
            <div class="slide crisis-slide">
                <h1>위기의 가족계획: 국제적 외면과 자원 부족</h1>
                <p class="subtitle">가족계획이 직면한 3대 위기와 긴급한 행동의 필요성</p>

                <div class="crisis-panels">
                    <!-- Panel 1: Funding Decline -->
                    <div class="crisis-panel panel-funding">
                        <div class="panel-header">
                            <span class="panel-icon">📉</span>
                            <h3>국제 우선순위 하락</h3>
                        </div>
                        <div class="key-metric">
                            <span class="metric-value">$100M</span>
                            <span class="metric-label">자금 감소 (1995-2003)</span>
                        </div>
                        <canvas id="fundingDeclineChart"></canvas>
                        <ul class="panel-points">
                            <li>MDG 초기 목표에서 가족계획 제외</li>
                            <li>국제 자금 지원 감소</li>
                            <li>미국의 리더십 약화</li>
                        </ul>
                    </div>

                    <!-- Panel 2: Africa Crisis -->
                    <div class="crisis-panel panel-africa">
                        <div class="panel-header">
                            <span class="panel-icon">🌍</span>
                            <h3>아프리카 위기</h3>
                        </div>
                        <div class="key-metric">
                            <span class="metric-value">3.6배</span>
                            <span class="metric-label">Niger 인구 증가 (2050년까지)</span>
                        </div>
                        <div id="africaCrisisMap"></div>
                        <ul class="panel-points">
                            <li>사하라이남: 2억명 미충족 수요</li>
                            <li>26개국 인구 연 2% 이상 증가</li>
                            <li>모성사망 32% 예방 가능</li>
                        </ul>
                    </div>

                    <!-- Panel 3: Resource Gap -->
                    <div class="crisis-panel panel-resource">
                        <div class="panel-header">
                            <span class="panel-icon">💰</span>
                            <h3>자원 격차</h3>
                        </div>
                        <div class="key-metric">
                            <span class="metric-value">$3.8B</span>
                            <span class="metric-label">10년 필요 자금</span>
                        </div>
                        <canvas id="resourceGapChart"></canvas>
                        <ul class="panel-points">
                            <li>아프리카 2006: $270M 필요</li>
                            <li>가용 자금: $113M (공여국) + $87M (국내)</li>
                            <li>자금 격차 지속 확대</li>
                        </ul>
                    </div>
                </div>

                <p class="citation-footer">
                    <span style="color: #000000; font-size: 16px; font-weight: 500;">※ 2025년: US 가족계획 원조 $1.74B 요청, 아프리카 미충족 수요 24% (UNFPA, 2024)</span>
                </p>
            </div>

            <!-- Slide 7: MDG와 가족계획 (원래 Slide 6) -->
            <div class="slide">
                <h1>밀레니엄 개발목표(MDG)와 가족계획</h1>
                <div class="two-column">
                    <div>
                        <h3>MDG와 가족계획 연계</h3>
                        <div class="panel-box">
                            <h4>MDG 5: 모성 건강 개선</h4>
                            <p style="font-size: 19px;">
                                <strong>목표 5A:</strong> 모성 사망률 75% 감소<br>
                                <strong>목표 5B:</strong> 생식건강 보편적 접근<br>
                                <span style="margin-left: 20px;">• 2007년 추가 (초기 MDG에서 제외)</span><br>
                                <span style="margin-left: 20px;">• 모성 사망 32% 예방 가능</span>
                            </p>
                        </div>
                        <div class="panel-box">
                            <h4>MDG 4: 아동 사망률 감소</h4>
                            <p style="font-size: 19px;">
                                <span style="margin-left: 20px;">• 출산 간격 조절로 영아 사망 감소</span><br>
                                <span style="margin-left: 20px;">• 아동 사망 10% 감소 가능</span><br>
                                <span style="margin-left: 20px;">• 산전 관리 접근성 개선</span>
                            </p>
                        </div>
                        <div class="panel-box">
                            <h4>MDG 1 & 3: 빈곤 퇴치와 성평등</h4>
                            <p style="font-size: 19px;">
                                <span style="margin-left: 20px;">• 가구 규모 감소로 자원 집중</span><br>
                                <span style="margin-left: 20px;">• 여성 노동 참여 증가</span><br>
                                <span style="margin-left: 20px;">• 교육 기회 확대</span>
                            </p>
                        </div>
                    </div>
                    <div>
                        <h3>생식건강 목표의 역사</h3>
                        <div class="quote-box" style="background: linear-gradient(135deg, #fef5e7 0%, #fdebd0 100%);">
                            <p style="font-size: 20px;">
                                <strong>1994년:</strong> 카이로 회의 - 생식건강권 합의<br>
                                <strong>2000년:</strong> MDG 제정 - 생식건강 제외<br>
                                <strong>2007년:</strong> MDG 5B 추가 (13년 지연)
                            </p>
                        </div>
                        <div class="panel-box" style="margin-top: 15px;">
                            <h4>달성 현황 (2015년)</h4>
                            <ul style="font-size: 18px; padding-left: 20px; list-style: none;">
                                <li style="margin: 8px 0;">• <strong>모성 사망률:</strong> 45% 감소 (목표 75% 미달)</li>
                                <li style="margin: 8px 0;">• <strong>피임률:</strong> 64% (55%에서 증가)</li>
                                <li style="margin: 8px 0;">• <strong>미충족 수요:</strong> 12% 여성</li>
                                <li style="margin: 8px 0;">• <strong>산전 관리(4회+):</strong> 64%</li>
                            </ul>
                        </div>
                        <div class="quote-box" style="margin-top: 15px;">
                            <p>"가족계획은 모든 MDG 달성의 핵심 개입"</p>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Slide 8: 경제적 영향과 남한 사례 -->
            <div class="slide">
                <h1>인구 배당과 경제 성장: 남한 사례</h1>
                <div class="two-column">
                    <div>
                        <h3>대한민국의 인구 구조 변화 (1960-2040)</h3>
                        <!-- 인구 피라미드 선택 버튼 -->
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button onclick="showPyramid('1960')" class="pyramid-btn" id="btn1960" style="flex: 1; padding: 8px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer;">1960년</button>
                            <button onclick="showPyramid('2000')" class="pyramid-btn" id="btn2000" style="flex: 1; padding: 8px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer;">2000년</button>
                            <button onclick="showPyramid('2040')" class="pyramid-btn" id="btn2040" style="flex: 1; padding: 8px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer;">2040년 (예측)</button>
                        </div>
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <canvas id="koreaPyramidChart"></canvas>
                            <div id="pyramidDescription" style="position: absolute; bottom: 10px; left: 10px; right: 10px; background: rgba(255,255,255,0.9); padding: 10px; border-radius: 5px; font-size: 14px;">
                                <strong>1960년:</strong> 전형적인 피라미드형 - 높은 출생률과 젊은 인구 구조
                            </div>
                        </div>
                        <p style="font-size: 14px; font-style: italic; margin-top: 5px;">
                            Republic of Korea Age Structure (Figure 1)
                        </p>
                        <div class="panel-box" style="margin-top: 15px;">
                            <h4>주요 정책 개입</h4>
                            <ul style="font-size: 17px;">
                                <li><strong>1961년:</strong> 가족계획 국가 프로그램 시작</li>
                                <li><strong>1973년:</strong> 모자보건법 제정</li>
                                <li><strong>1983년:</strong> 두 자녀 정책 강화</li>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <h3>경제적 영향</h3>
                        <div class="panel-box" style="background: linear-gradient(135deg, #e5f5e0 0%, #c8e6c9 100%);">
                            <h4>인구 배당 효과</h4>
                            <p style="font-size: 19px;">
                                <strong>동아시아 경제 기적:</strong><br>
                                1965-1990년 경제성장의 <strong>약 1/3</strong>이 인구구조 변화에 기인
                            </p>
                        </div>
                        <div class="data-card" style="margin-top: 15px;">
                            <h4>TFR 감소</h4>
                            <div style="display: flex; align-items: center; justify-content: center;">
                                <span style="font-size: 42px; font-weight: bold;">6.0</span>
                                <span style="font-size: 18px; margin: 0 10px;">→</span>
                                <span style="font-size: 42px; font-weight: bold;">1.6</span>
                            </div>
                            <p style="font-size: 16px;">1960-1990년</p>
                        </div>
                        <div class="data-card" style="margin-top: 10px;">
                            <h4>경제 성장</h4>
                            <p style="font-size: 19px;">
                                <span style="margin-left: 20px;">• GDP 연평균 8% 성장</span><br>
                                <span style="margin-left: 20px;">• 1인당 소득 20배 증가</span><br>
                                <span style="margin-left: 20px;">• 저축률 35% 달성</span>
                            </p>
                            <p style="font-size: 16px; color: #c97064; margin-top: 10px; font-style: italic;">
                                ※ 2025년 현황: 한국 TFR 0.75 (세계 최저), 9년만에 첫 상승 (KOSIS, 2024)
                            </p>
                        </div>
                    </div>
                </div>
            </div>



            <!-- Slide 9: 피임법 공급원 및 효과성 - Figure 6 & Table 3 기반 -->
            <div class="slide">
                <h1>피임법 공급원 및 효과성 분석</h1>

                <!-- iframe으로 외부 시각화 삽입 -->
                <div style="position: relative; height: calc(100% - 100px); margin-top: 20px;">
                    <iframe
                        src="contraceptive-supply-viz.html"
                        style="width: 100%; height: 100%; border: none; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"
                        title="피임법 공급원 인터랙티브 시각화">
                    </iframe>
                </div>

                <!-- 대체 콘텐츠 (iframe 미지원 시) -->
                <noscript>
                <div style="display: grid; grid-template-columns: 1.2fr 1fr 0.8fr; gap: 25px; height: calc(100% - 120px);">
                    <!-- 왼쪽: 세계 지도 -->
                    <div>
                        <h3 style="color: #2D5F5D; margin-bottom: 10px; font-size: 18px;">피임약 공급원 분포</h3>
                        <div id="contraceptiveSupplyMap" style="height: 320px; border-radius: 8px; border: 2px solid #2D5F5D;"></div>

                        <div style="margin-top: 15px; background: #f5f0e6; padding: 12px; border-radius: 6px;">
                            <h4 style="color: #234d48; margin-bottom: 8px; font-size: 15px;">지역별 특징</h4>
                            <ul style="font-size: 13px; color: #576066; padding-left: 18px; line-height: 1.5;">
                                <li><strong>사하라이남:</strong> 클리닉 의존 (60-93%)</li>
                                <li><strong>라틴아메리카:</strong> 약국 중심 (40-70%)</li>
                                <li><strong>아시아:</strong> 혼합형 체계</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 가운데: 효과성 데이터 (Table 3) -->
                    <div>
                        <h3 style="color: #2D5F5D; margin-bottom: 10px; font-size: 18px;">피임법 효과성</h3>

                        <!-- 가장 효과적 -->
                        <div style="background: linear-gradient(135deg, #2D5F5D, #3a7a6f); padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                            <h4 style="color: white; font-size: 14px; margin-bottom: 8px;">가장 효과적 (실패율 &lt;1%)</h4>
                            <div style="font-size: 12px; color: #e8f5f2; line-height: 1.6;">
                                <div style="display: flex; justify-content: space-between; margin: 3px 0;">
                                    <span>임플란트</span>
                                    <span style="font-weight: bold;">0.1%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin: 3px 0;">
                                    <span>불임술</span>
                                    <span style="font-weight: bold;">0.5%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin: 3px 0;">
                                    <span>자궁내장치(IUD)</span>
                                    <span style="font-weight: bold;">0.6%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin: 3px 0;">
                                    <span>주사제</span>
                                    <span style="font-weight: bold;">0.3%</span>
                                </div>
                            </div>
                        </div>

                        <!-- 효과적 -->
                        <div style="background: linear-gradient(135deg, #8B6F47, #a08660); padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                            <h4 style="color: white; font-size: 14px; margin-bottom: 8px;">효과적 (실패율 2-10%)</h4>
                            <div style="font-size: 12px; color: #fff5e8; line-height: 1.6;">
                                <div style="display: flex; justify-content: space-between; margin: 3px 0;">
                                    <span>경구피임약</span>
                                    <span style="font-weight: bold;">6.9%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin: 3px 0;">
                                    <span>콘돔</span>
                                    <span style="font-weight: bold;">9.8%</span>
                                </div>
                            </div>
                        </div>

                        <!-- 덜 효과적 -->
                        <div style="background: linear-gradient(135deg, #D4A574, #e0b892); padding: 12px; border-radius: 8px;">
                            <h4 style="color: white; font-size: 14px; margin-bottom: 8px;">덜 효과적 (실패율 &gt;15%)</h4>
                            <div style="font-size: 12px; color: #fff8f0; line-height: 1.6;">
                                <div style="display: flex; justify-content: space-between; margin: 3px 0;">
                                    <span>질외사정</span>
                                    <span style="font-weight: bold;">15.1%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin: 3px 0;">
                                    <span>주기법</span>
                                    <span style="font-weight: bold;">21.6%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 오른쪽: 공급원 차트 -->
                    <div>
                        <h3 style="color: #2D5F5D; margin-bottom: 10px; font-size: 18px;">공급원 분포</h3>
                        <canvas id="supplySourceChart" style="height: 280px;"></canvas>

                        <div style="margin-top: 15px; background: #f8f6f2; padding: 12px; border-radius: 8px;">
                            <h4 style="color: #234d48; font-size: 14px; margin-bottom: 8px;">지역별 사용률</h4>
                            <canvas id="methodEffectivenessChart" style="height: 150px;"></canvas>
                        </div>
                    </div>
                </div>
                </noscript>

                <div style="text-align: center; margin-top: 10px;">
                    <p style="font-size: 13px; font-style: italic; color: #6b7280;">
                        DHS 데이터 기반 분석 (Figure 6 & Table 3)
                    </p>
                    <button onclick="window.open('contraceptive-supply-viz.html', '_blank')"
                            style="margin-top: 10px; padding: 8px 16px; background: #2D5F5D; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        🔍 전체화면으로 보기
                    </button>
                </div>
            </div>

            <!-- Slide 10: 미충족 수요 - 가족계획의 핵심 과제 -->
            <div class="slide">
                <h1>미충족 수요: 가족계획의 핵심 과제</h1>

                <!-- 미충족 수요 정의 및 핵심 통계 -->
                <div style="background: linear-gradient(135deg, #fee2e2, #fef3c7); padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                    <h3 style="color: #dc2626; margin-bottom: 10px;">미충족 수요 (Unmet Need)란?</h3>
                    <p style="font-size: 19px; margin-bottom: 20px;">임신을 피하거나 연기하고 싶지만 피임을 하지 않는 기혼 여성</p>
                    <div style="display: flex; justify-content: space-around;">
                        <div style="text-align: center;">
                            <strong style="font-size: 36px; color: #dc2626;">2억 명</strong>
                            <br/>전 세계 미충족 수요 여성
                        </div>
                        <div style="text-align: center;">
                            <strong style="font-size: 36px; color: #ef4444;">24%</strong>
                            <br/>사하라이남 아프리카
                        </div>
                        <div style="text-align: center;">
                            <strong style="font-size: 36px; color: #f59e0b;">9%</strong>
                            <br/>동아시아
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <!-- 왼쪽: 4대 장벽 -->
                    <div>
                        <h3 style="margin-bottom: 15px;">미충족 수요의 4대 장벽</h3>
                        <div style="display: grid; gap: 12px;">
                            <div style="background: #fff7ed; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                                <h4 style="margin: 0 0 5px; color: #92400e;">지식 부족</h4>
                                <p style="margin: 0; font-size: 16px;">피임법과 사용법에 대한 정보 부재</p>
                            </div>
                            <div style="background: #fef3c7; padding: 15px; border-radius: 8px; border-left: 4px solid #eab308;">
                                <h4 style="margin: 0 0 5px; color: #713f12;">사회적 반대</h4>
                                <p style="margin: 0; font-size: 16px;">가족과 지역사회의 부정적 시각</p>
                            </div>
                            <div style="background: #fed7aa; padding: 15px; border-radius: 8px; border-left: 4px solid #ea580c;">
                                <h4 style="margin: 0 0 5px; color: #7c2d12;">건강 우려</h4>
                                <p style="margin: 0; font-size: 16px;">부작용과 건강 문제에 대한 두려움</p>
                            </div>
                            <div style="background: #fecaca; padding: 15px; border-radius: 8px; border-left: 4px solid #dc2626;">
                                <h4 style="margin: 0 0 5px; color: #7f1d1d;">배우자 반대 인식</h4>
                                <p style="margin: 0; font-size: 16px;">남편이 반대할 것이라는 여성의 인식</p>
                            </div>
                        </div>
                    </div>

                    <!-- 오른쪽: 건강 영향 및 빈곤 격차 -->
                    <div>
                        <h3 style="margin-bottom: 15px;">가족계획의 건강 영향</h3>
                        <div style="background: #dcfce7; padding: 18px; border-radius: 10px; margin-bottom: 20px;">
                            <ul style="margin: 0; padding-left: 20px; font-size: 17px; line-height: 1.8;">
                                <li><strong>32%</strong> 모성사망 예방 (연간 15만명)</li>
                                <li><strong>10%</strong> 5세 미만 아동사망 감소</li>
                                <li><strong>90%</strong> 안전하지 않은 낙태 관련 사망 예방</li>
                            </ul>
                        </div>

                        <h3 style="margin-bottom: 15px;">빈곤과 미충족 수요</h3>
                        <div style="background: #f0f9ff; padding: 18px; border-radius: 10px;">
                            <p style="margin: 0 0 10px; font-size: 17px;">
                                <strong style="color: #0369a1;">최빈곤층 여성</strong>의 미충족 수요는<br/>
                                <strong style="color: #0ea5e9;">최부유층의 2배</strong>
                            </p>
                            <div style="display: flex; justify-content: space-around; margin-top: 10px;">
                                <div>
                                    <strong style="color: #0c4a6e;">최빈곤층</strong><br/>
                                    26-30%
                                </div>
                                <div>
                                    <strong style="color: #0284c7;">최부유층</strong><br/>
                                    13-15%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                </div>
            </div>

            <!-- Slide 10: 핵심 메시지 -->
            <div class="slide">
                <h1>핵심 메시지와 행동 촉구</h1>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div>
                        <h3>미완의 과제</h3>
                        <div class="panel-box">
                            <ul style="font-size: 19px; line-height: 1.8;">
                                <li>전 세계 미충족 수요 증가</li>
                                <li>높은 모성 사망률 지속</li>
                                <li>청소년 임신 문제</li>
                                <li>성평등 과제</li>
                            </ul>
                        </div>
                        <h3 style="margin-top: 20px;">기회의 창</h3>
                        <div class="panel-box" style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);">
                            <ul style="font-size: 19px; line-height: 1.8;">
                                <li>인구 배당 효과 실현</li>
                                <li>SDG 목표 달성</li>
                                <li>기후 변화 완화</li>
                                <li>경제 성장 가속화</li>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <h3>행동 촉구</h3>
                        <div class="data-card" style="background: #69b7a4; color: white;">
                            <h4 style="color: white;">정부</h4>
                            <p>정치적 의지와 자원 투입</p>
                        </div>
                        <div class="data-card" style="margin-top: 10px; background: #8fa68e; color: white;">
                            <h4 style="color: white;">개발 파트너</h4>
                            <p>지속가능한 자금 지원</p>
                        </div>
                        <div class="data-card" style="margin-top: 10px; background: #a8957e; color: white;">
                            <h4 style="color: white;">시민사회</h4>
                            <p>옹호와 모니터링</p>
                        </div>
                        <div class="data-card" style="margin-top: 10px; background: #c4a977; color: white;">
                            <h4 style="color: white;">개인</h4>
                            <p>정보 기반 선택</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide 12: 참고문헌 (APA 7th Edition) -->
            <div class="slide">
                <h1>참고문헌 (References)</h1>
                <div style="overflow-y: auto; height: calc(100% - 100px); padding-right: 20px;">
                    <div class="panel-box" style="background: #f9fafb; padding: 15px;">
                        <p style="font-size: 14px; line-height: 1.5; text-align: left; color: #2d3a3a;">

                            Central Intelligence Agency. (2024). Niger. In <em>The World Factbook</em>. https://www.cia.gov/the-world-factbook/countries/niger/<br><br>

                            World Bank. (2022). <em>Arable land (% of land area) - Niger</em> [Data set]. World Development Indicators. https://data.worldbank.org/indicator/AG.LND.ARBL.ZS?locations=NE<br><br>

                            Bloom, D. E., Canning, D., & Sevilla, J. (2003). <em>The demographic dividend: A new perspective on the economic consequences of population change</em>. RAND Corporation.<br>

                            Bongaarts, J., & Bruce, J. (1995). The causes of unmet need for contraception and the social content of services. <em>Studies in Family Planning, 26</em>(2), 57-75.<br>

                            Family planning: The unfinished agenda. <em>The Lancet, 368</em>(9549), 1810-1827. https://doi.org/10.1016/S0140-6736(06)69480-4<br>

                            Korean Statistical Information Service (KOSIS). (2024). <em>Total fertility rate statistics</em>. https://kosis.kr<br>

                            Population Connection Action. (2024). <em>FY2025 funding request for family planning</em>. https://www.populationconnectionaction.org<br>

                            Family Planning 2030. (2023). <em>FP2030 progress report 2023: The arc of progress</em>. https://fp2030.org<br>

                            Guttmacher Institute. (2023). <em>Adding it up: Investing in sexual and reproductive health</em>. https://www.guttmacher.org<br>

                            Population Council. (2023). <em>Evidence for action: Research to improve family planning programs</em>. https://www.popcouncil.org<br>

                            Seltzer, J. R. (2002). <em>The origins and evolution of family planning programs in developing countries</em>. RAND Corporation.<br>

                            Singh, S., Darroch, J. E., & Ashford, L. S. (2014). <em>Adding it up: The costs and benefits of investing in sexual and reproductive health</em>. Guttmacher Institute & UNFPA.<br>

                            Track20. (2023). <em>Family planning estimation tool</em>. http://www.track20.org<br>

                            United Nations, Department of Economic and Social Affairs, Population Division. (2024). <em>World population prospects 2024 revision</em>. UN DESA.<br>

                            United Nations Population Fund (UNFPA). (2024). <em>State of world population 2024</em>. UNFPA.<br>

                            United Nations Population Fund (UNFPA). (2024). <em>West and Central Africa regional report: Unmet need for family planning</em>. UNFPA WCARO.<br>

                            World Bank. (2023). <em>World development indicators: Fertility rate, total (births per woman)</em>. https://data.worldbank.org<br>

                            World Health Organization. (2023). <em>Family planning/contraception methods: Fact sheet</em>. WHO.<br>

                            World Health Organization. (2022). <em>Medical eligibility criteria for contraceptive use</em> (5th ed.). WHO Press.<br>

                            World Health Organization. (2018). <em>Family planning: A global handbook for providers</em> (3rd ed.). WHO Press & Johns Hopkins Bloomberg School of Public Health.

                        </p>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <p style="font-size: 20px; color: #718096;">
                        <strong>Note:</strong> 본 프레젠테이션의 주요 데이터는 원 연구를 기반으로 하며, 최신 통계는 위 기관들의 2022-2023년 자료를 참조하였습니다.
                    </p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // 슬라이드 네비게이션
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;

        // 페이지 카운터 생성
        function createPageCounter() {
            const counter = document.createElement('div');
            counter.className = 'page-counter';
            counter.id = 'pageCounter';
            document.body.appendChild(counter);
            updatePageCounter();
        }

        // 페이지 카운터 업데이트
        function updatePageCounter() {
            const counter = document.getElementById('pageCounter');
            if (counter) {
                counter.textContent = `${currentSlide + 1} | ${totalSlides}`;
            }
        }

        // 툴팁 위치 계산 함수
        function calculateTooltipPosition(tooltip, container) {
            const tooltipRect = tooltip.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();

            let x = tooltip.style.left;
            let y = tooltip.style.top;

            // 오른쪽 경계 체크
            if (tooltipRect.right > containerRect.right) {
                x = containerRect.right - tooltipRect.width - 10 + 'px';
            }

            // 왼쪽 경계 체크
            if (tooltipRect.left < containerRect.left) {
                x = containerRect.left + 10 + 'px';
            }

            // 아래쪽 경계 체크
            if (tooltipRect.bottom > containerRect.bottom) {
                y = containerRect.bottom - tooltipRect.height - 10 + 'px';
            }

            // 위쪽 경계 체크
            if (tooltipRect.top < containerRect.top) {
                y = containerRect.top + 10 + 'px';
            }

            tooltip.style.left = x;
            tooltip.style.top = y;
        }

        // 인용 형식화 함수들
        // Citation functions removed - this presentation is about the paper itself

        function showSlide(index) {
            if (index < 0) index = totalSlides - 1;
            if (index >= totalSlides) index = 0;

            slides.forEach(slide => slide.classList.remove('active'));
            slides[index].classList.add('active');
            currentSlide = index;

            // 페이지 카운터 업데이트
            updatePageCounter();

            // 슬라이드별 차트 및 지도 초기화
            initSlideContent(index);
        }

        // 키보드 네비게이션
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                showSlide(currentSlide + 1);
            } else if (e.key === 'ArrowLeft') {
                showSlide(currentSlide - 1);
            } else if (e.key === 'Home') {
                showSlide(0);
            } else if (e.key === 'End') {
                showSlide(totalSlides - 1);
            }
        });

        // 국가 데이터
        const countryData = {
            niger: {
                name: '니제르',
                coords: [13.5, 2.1],
                tfr: 7.1, /* Corrected TFR per Table 2 */
                contraceptive: 4.6, /* Corrected from 5% to 4.6% per Table 2 */
                unmetNeed: 19,
                maternalMortality: 553,
                trend: '위기 - 급속한 인구 증가',
                color: '#c97064'
            },
            kenya: {
                name: '케냐',
                coords: [-1.3, 36.8],
                tfr: 4.8,
                contraceptive: 41,
                unmetNeed: 18,
                maternalMortality: 342,
                trend: '정체 - 추가 노력 필요',
                color: '#c4a977'
            },
            brazil: {
                name: '브라질',
                coords: [-14.2, -51.9],
                tfr: 2.5, /* Corrected from 2.3 to 2.5 per Panel 6 */
                contraceptive: 77,
                unmetNeed: 6,
                maternalMortality: 60,
                trend: '성공 - 자연적 감소',
                color: '#69b7a4'
            },
            bangladesh: {
                name: '방글라데시',
                coords: [23.7, 90.4],
                tfr: 3.0,
                contraceptive: 58,
                unmetNeed: 12,
                maternalMortality: 173,
                trend: '빠른 진전',
                color: '#7db8b5'
            },
            pakistan: {
                name: '파키스탄',
                coords: [30.4, 69.3],
                tfr: 4.3,
                contraceptive: 30,
                unmetNeed: 20,
                maternalMortality: 140,
                trend: '느린 진전',
                color: '#c4a977'
            },
            iran: {
                name: '이란',
                coords: [32.4, 53.7],
                tfr: 2.0,
                contraceptive: 73,
                unmetNeed: 8,
                maternalMortality: 16,
                trend: '성공 사례',
                color: '#69b7a4'
            },
            thailand: {
                name: '태국',
                coords: [15.9, 100.9],
                tfr: 1.8,
                contraceptive: 72,
                unmetNeed: 7,
                maternalMortality: 37,
                trend: '성공 사례',
                color: '#69b7a4'
            },
            rwanda: {
                name: '르완다',
                coords: [-1.9, 29.9],
                tfr: 4.0,
                contraceptive: 53,
                unmetNeed: 14,
                maternalMortality: 248,
                trend: '빠른 개선',
                color: '#7db8b5'
            },
            mexico: {
                name: '멕시코',
                coords: [23.6, -102.5],
                tfr: 2.2,
                contraceptive: 67,
                unmetNeed: 10,
                maternalMortality: 33,
                trend: '지속적 개선',
                color: '#69b7a4'
            },
            indonesia: {
                name: '인도네시아',
                coords: [-0.8, 113.9],
                tfr: 2.4,
                contraceptive: 61,
                unmetNeed: 11,
                maternalMortality: 177,
                trend: '꾸준한 진전',
                color: '#7db8b5'
            },
            vietnam: {
                name: '베트남',
                coords: [14.1, 108.3],
                tfr: 1.9,
                contraceptive: 68,
                unmetNeed: 9,
                maternalMortality: 43,
                trend: '성공 사례',
                color: '#69b7a4'
            }
        };

        // 지도 인스턴스 저장
        let maps = {};

        // 지도 생성 함수
        function createMap(elementId, center = [0, 0], zoom = 2) {
            if (maps[elementId]) {
                maps[elementId].remove();
            }

            const mapElement = document.getElementById(elementId);
            if (!mapElement) return null;

            const map = L.map(elementId).setView(center, zoom);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            maps[elementId] = map;
            return map;
        }

        // 국가 마커 추가 함수
        function addCountryMarker(map, country) {
            const data = countryData[country];
            if (!data || !map) return;

            const marker = L.circleMarker(data.coords, {
                radius: 8,
                fillColor: data.color,
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map);

            // 커스텀 툴팁 HTML
            const tooltipContent = `
                <div class="map-tooltip">
                    <h4>${data.name}</h4>
                    <div class="tooltip-stat">
                        <span class="tooltip-label">합계출산율:</span>
                        <span class="tooltip-value">${data.tfr}명</span>
                    </div>
                    <div class="tooltip-stat">
                        <span class="tooltip-label">피임 사용률:</span>
                        <span class="tooltip-value">${data.contraceptive}%</span>
                    </div>
                    <div class="tooltip-stat">
                        <span class="tooltip-label">미충족 수요:</span>
                        <span class="tooltip-value">${data.unmetNeed}%</span>
                    </div>
                    <div class="tooltip-stat">
                        <span class="tooltip-label">모성사망률:</span>
                        <span class="tooltip-value">${data.maternalMortality}/10만</span>
                    </div>
                    <div class="tooltip-trend ${data.color === '#10b981' ? 'trend-positive' : data.color === '#dc2626' ? 'trend-negative' : 'trend-neutral'}">
                        ${data.trend}
                    </div>
                </div>
            `;

            marker.bindTooltip(tooltipContent, {
                permanent: false,
                direction: 'top',
                className: 'custom-tooltip',
                offset: [0, -10]
            });

            marker.on('mouseover', function() {
                this.openTooltip();
            });

            marker.on('mouseout', function() {
                this.closeTooltip();
            });

            return marker;
        }

        // 차트 생성 함수
        function createChart(canvasId, config) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            // 기존 차트 제거
            if (canvas.chart) {
                canvas.chart.destroy();
            }

            canvas.chart = new Chart(ctx, config);
        }

        // 한국 인구 피라미드 데이터 및 함수
        const koreaPyramidData = {
            '1960': {
                labels: ['0-4', '5-9', '10-14', '15-19', '20-24', '25-29', '30-34', '35-39', '40-44', '45-49', '50-54', '55-59', '60-64', '65-69', '70-74', '75+'],
                males: [-2800, -2400, -2000, -1800, -1600, -1400, -1200, -1000, -900, -800, -700, -600, -500, -400, -300, -200],
                females: [2600, 2200, 1900, 1700, 1500, 1300, 1100, 950, 850, 750, 650, 550, 450, 350, 250, 180],
                description: '전형적인 피라미드형 - 높은 출생률과 젊은 인구 구조'
            },
            '2000': {
                labels: ['0-4', '5-9', '10-14', '15-19', '20-24', '25-29', '30-34', '35-39', '40-44', '45-49', '50-54', '55-59', '60-64', '65-69', '70-74', '75+'],
                males: [-1400, -1600, -1800, -2000, -2100, -2000, -2100, -2200, -1900, -1600, -1300, -1000, -800, -600, -400, -300],
                females: [1300, 1500, 1700, 1900, 2000, 1900, 2000, 2100, 1800, 1500, 1200, 950, 750, 600, 450, 400],
                description: '항아리형 - 출산율 감소로 젊은 층 감소, 중년층 증가'
            },
            '2040': {
                labels: ['0-4', '5-9', '10-14', '15-19', '20-24', '25-29', '30-34', '35-39', '40-44', '45-49', '50-54', '55-59', '60-64', '65-69', '70-74', '75+'],
                males: [-1000, -1100, -1200, -1300, -1400, -1500, -1600, -1700, -1800, -1900, -2000, -2100, -2200, -2000, -1800, -1500],
                females: [950, 1050, 1150, 1250, 1350, 1450, 1550, 1650, 1750, 1850, 1950, 2050, 2150, 2000, 1850, 2000],
                description: '역피라미드형 - 극도로 낮은 출생률과 고령화된 인구 구조'
            }
        };

        let currentPyramidChart = null;

        function showPyramid(year) {
            // 버튼 스타일 업데이트
            document.querySelectorAll('.pyramid-btn').forEach(btn => {
                btn.style.background = '#6b7280';
            });
            document.getElementById(`btn${year}`).style.background = '#3b82f6';

            // 설명 업데이트
            const descDiv = document.getElementById('pyramidDescription');
            if (descDiv) {
                descDiv.innerHTML = `<strong>${year}년:</strong> ${koreaPyramidData[year].description}`;
            }

            // 차트 업데이트
            const canvas = document.getElementById('koreaPyramidChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const data = koreaPyramidData[year];

            if (currentPyramidChart) {
                currentPyramidChart.destroy();
            }

            currentPyramidChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: '남성',
                            data: data.males,
                            backgroundColor: 'rgba(54, 162, 235, 0.7)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '여성',
                            data: data.females,
                            backgroundColor: 'rgba(255, 99, 132, 0.7)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        title: {
                            display: true,
                            text: `한국 인구구조 ${year}`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = Math.abs(context.parsed.x);
                                    return context.dataset.label + ': ' + value.toLocaleString() + '천명';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: false,
                            ticks: {
                                callback: function(value) {
                                    return Math.abs(value).toLocaleString();
                                }
                            },
                            title: {
                                display: true,
                                text: '인구 (천명)'
                            },
                            grid: {
                                display: true
                            }
                        },
                        y: {
                            stacked: false,
                            position: 'center',
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // 슬라이드별 콘텐츠 초기화
        function initSlideContent(slideIndex) {
            switch(slideIndex) {
                case 1: // 역사적 맥락
                    createChart('historicalTrend', {
                        type: 'line',
                        data: {
                            labels: ['1960', '1970', '1980', '1990', '1994', '2000', '2010', '2020'],
                            datasets: [{
                                label: '세계 평균 TFR',
                                data: [5.0, 4.5, 3.6, 3.0, 2.75, 2.5, 2.4, 2.3],
                                borderColor: 'var(--primary-green)',
                                backgroundColor: 'rgba(74, 124, 78, 0.1)',
                                tension: 0.3
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: '세계 평균 합계출산율 변화',
                                    font: { family: 'SeoulHangang', weight: 700 }
                                },
                                annotation: {
                                    annotations: {
                                        line1: {
                                            type: 'line',
                                            xMin: '1960',
                                            xMax: '1960',
                                            borderColor: 'rgb(255, 99, 132)',
                                            borderWidth: 2,
                                            label: {
                                                display: true,
                                                content: '1960년대: 인구폭발 우려',
                                                position: 'start'
                                            }
                                        },
                                        line2: {
                                            type: 'line',
                                            xMin: '1994',
                                            xMax: '1994',
                                            borderColor: 'rgb(54, 162, 235)',
                                            borderWidth: 2,
                                            label: {
                                                display: true,
                                                content: '1994 카이로 회의',
                                                position: 'center'
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    });
                    break;

                case 2: // 글로벌 인구 현황
                    setTimeout(() => {
                        const map = createMap('worldMap');
                        if (map) {
                            // 모든 국가 마커 추가
                            Object.keys(countryData).forEach(country => {
                                addCountryMarker(map, country);
                            });
                        }
                    }, 100);
                    break;

                case 3: // 니제르 사례
                    setTimeout(() => {
                        const map = createMap('nigerMap', [17, 8], 6);
                        if (map) {
                            addCountryMarker(map, 'niger');

                            // 주변 국가도 표시
                            addCountryMarker(map, 'kenya');
                        }
                    }, 100);
                    break;

                case 4: // 통합된 성공/실패 사례 (슬라이드 5-6 병합)
                    // 남아시아 비교 차트 생성
                    createChart('southAsiaComparison', {
                        type: 'line',
                        data: {
                            labels: ['1975', '1985', '1995', '2005', '2015'],
                            datasets: [
                                {
                                    label: '방글라데시',
                                    data: [6.3, 5.1, 3.4, 2.9, 2.3],
                                    borderColor: '#69b7a4',
                                    backgroundColor: 'rgba(105, 183, 164, 0.1)',
                                    borderWidth: 3,
                                    tension: 0.3
                                },
                                {
                                    label: '파키스탄',
                                    data: [6.3, 6.0, 5.4, 4.3, 3.7],
                                    borderColor: 'var(--secondary-brown)',
                                    backgroundColor: 'rgba(160, 82, 45, 0.1)',
                                    borderWidth: 3,
                                    borderDash: [5, 5],
                                    tension: 0.3
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'TFR 변화 비교: 성공 vs 정체',
                                    font: {
                                        family: 'SeoulHangang',
                                        size: 16,
                                        weight: 700
                                    }
                                },
                                legend: {
                                    display: true,
                                    position: 'top',
                                    labels: {
                                        font: { family: 'SeoulNamsan', size: 13 },
                                        usePointStyle: true
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    min: 2,
                                    max: 7,
                                    title: {
                                        display: true,
                                        text: '합계출산율(TFR)',
                                        font: { family: 'SeoulNamsan' }
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: '연도',
                                        font: { family: 'SeoulNamsan' }
                                    }
                                }
                            }
                        }
                    });
                    break;

                case 5: // 위기의 가족계획
                    // Funding Decline Chart
                    createChart('fundingDeclineChart', {
                        type: 'line',
                        data: {
                            labels: ['1995', '1997', '1999', '2001', '2003'],
                            datasets: [{
                                label: '국제 원조 (백만 달러)',
                                data: [560, 520, 480, 470, 460],
                                borderColor: 'var(--secondary-brown-dark)',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                borderWidth: 3,
                                tension: 0.3
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: '가족계획 원조 감소 ($560M → $460M)',
                                    font: { size: 14, weight: '600' },
                                    color: '#e5e7eb'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    ticks: { color: '#e5e7eb' }
                                },
                                x: {
                                    grid: { display: false },
                                    ticks: { color: '#e5e7eb' }
                                }
                            }
                        }
                    });

                    // Africa Crisis Map
                    setTimeout(() => {
                        const mapDiv = document.getElementById('africaCrisisMap');
                        if (mapDiv && !mapDiv._leaflet_id) {
                            const map = L.map('africaCrisisMap', {
                                center: [0, 20],
                                zoom: 3,
                                zoomControl: false,
                                attributionControl: false,
                                scrollWheelZoom: false,
                                doubleClickZoom: false,
                                dragging: false
                            });

                            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                                maxZoom: 19
                            }).addTo(map);

                            // Crisis countries with unmet need data
                            const crisisCountries = [
                                { name: 'Niger', coords: [17, 8], unmetNeed: 16 },
                                { name: 'Chad', coords: [15, 19], unmetNeed: 23 },
                                { name: 'Mali', coords: [17, -4], unmetNeed: 29 },
                                { name: 'Uganda', coords: [1, 32], unmetNeed: 35 },
                                { name: 'Kenya', coords: [-1, 37], unmetNeed: 25 },
                                { name: 'Ethiopia', coords: [8, 38], unmetNeed: 34 },
                                { name: 'Nigeria', coords: [9, 8], unmetNeed: 17 },
                                { name: 'DRC', coords: [-3, 23], unmetNeed: 27 },
                                { name: 'Tanzania', coords: [-6, 35], unmetNeed: 22 }
                            ];

                            crisisCountries.forEach(country => {
                                const radius = 10 + (country.unmetNeed * 0.5);
                                L.circleMarker(country.coords, {
                                    radius: radius,
                                    fillColor: '#8B6F47',
                                    color: '#2D5F5D',
                                    weight: 3,
                                    opacity: 0.9,
                                    fillOpacity: 0.7
                                }).addTo(map)
                                .bindTooltip(`${country.name}: ${country.unmetNeed}% 미충족`, {
                                    permanent: false,
                                    direction: 'top',
                                    className: 'crisis-tooltip'
                                });
                            });
                        }
                    }, 100);

                    // Resource Gap Chart
                    createChart('resourceGapChart', {
                        type: 'bar',
                        data: {
                            labels: ['아프리카 필요(2006)', '공여국 지원', '국내 자원'],
                            datasets: [{
                                data: [270, 113, 87],
                                backgroundColor: ['#f59e0b', '#dc2626', '#dc2626'],
                                borderColor: ['#fbbf24', '#ef4444', '#ef4444'],
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: '아프리카 가족계획 자금 감소 (백만 달러)',
                                    font: { size: 14, weight: '600' },
                                    color: '#e5e7eb'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 300,
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    ticks: { color: '#e5e7eb' }
                                },
                                x: {
                                    grid: { display: false },
                                    ticks: { color: '#e5e7eb' }
                                }
                            }
                        }
                    });
                    break;

                case 6: // 건강 영향 (원래 case 5, 이전 case 7)
                    createChart('healthImpactChart', {
                        type: 'bar',
                        data: {
                            labels: ['모성 사망', '영아 사망'],
                            datasets: [{
                                label: '예방 가능 비율 (%)',
                                data: [32, 10],
                                backgroundColor: ['var(--secondary-brown)', 'var(--primary-green)']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: '가족계획으로 예방 가능한 사망',
                                    font: { family: 'SeoulHangang' }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 40
                                }
                            }
                        }
                    });
                    break;

                case 7: // MDG와 가족계획
                    // 인구 피라미드 초기화 (1960년 기본 표시)
                    showPyramid('1960');

                    createChart('southKoreaChart', {
                        type: 'line',
                        data: {
                            labels: ['1960', '1970', '1980', '1990', '2000'],
                            datasets: [{
                                label: 'TFR',
                                data: [6.0, 4.5, 2.8, 1.6, 1.5],
                                borderColor: 'var(--primary-green)',
                                backgroundColor: 'rgba(74, 124, 78, 0.1)',
                                yAxisID: 'y',
                                tension: 0.3
                            }, {
                                label: 'GDP 성장률 (%)',
                                data: [5, 9, 8, 9, 4],
                                borderColor: 'var(--secondary-brown)',
                                backgroundColor: 'rgba(160, 82, 45, 0.1)',
                                yAxisID: 'y1',
                                borderDash: [5, 5],
                                tension: 0.3
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'TFR 감소와 경제 성장의 상관관계',
                                    font: { family: 'SeoulHangang' }
                                },
                                legend: {
                                    display: true
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: 'TFR'
                                    }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: 'GDP 성장률 (%)'
                                    },
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                }
                            }
                        }
                    });
                    break;

                case 7: // 미충족 수요 (원래 case 10)
                    // 지역별 미충족 수요 차트
                    createChart('unmetNeedByRegion', {
                        type: 'bar',
                        data: {
                            labels: ['사하라이남', '서아시아/북아프리카', '남아시아', '라틴아메리카', '동아시아'],
                            datasets: [{
                                label: '미충족 수요율 (%)',
                                data: [24, 17, 13, 10, 6],
                                backgroundColor: ['#8b0000', '#cc4125', '#e06666', '#f4cccc', '#d9ead3']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 30
                                }
                            }
                        }
                    });

                    // 원인별 분포 차트
                    createChart('unmetNeedReasons', {
                        type: 'pie',
                        data: {
                            labels: ['부작용 우려', '접근성 부족', '문화적 반대', '정보 부족', '기타'],
                            datasets: [{
                                data: [35, 25, 20, 15, 5],
                                backgroundColor: ['var(--secondary-brown-dark)', 'var(--secondary-brown)', 'var(--secondary-brown-light)', 'var(--accent-yellow)', 'var(--accent-beige)']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        font: {
                                            size: 11
                                        }
                                    }
                                }
                            }
                        }
                    });

                    // 경제수준별 차이 차트
                    createChart('unmetNeedByWealth', {
                        type: 'line',
                        data: {
                            labels: ['최빈곤층', '빈곤층', '중산층', '부유층', '최부유층'],
                            datasets: [{
                                label: '미충족 수요 (%)',
                                data: [28, 22, 16, 12, 8],
                                borderColor: '#dc2626',
                                backgroundColor: 'rgba(220, 38, 38, 0.1)',
                                tension: 0.3
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 30
                                }
                            }
                        }
                    });
                    break;

                case 8: // 서비스 전달 (원래 case 11)
                    createChart('accessBarriers', {
                        type: 'doughnut',
                        data: {
                            labels: ['접근성', '부작용 우려', '문화적 반대', '비용'],
                            datasets: [{
                                data: [45, 26, 23, 6],
                                backgroundColor: ['var(--primary-green)', 'var(--primary-green-light)', 'var(--secondary-brown-light)', 'var(--secondary-brown)']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });

                    // 서비스 품질 지표 차트
                    createChart('serviceQuality', {
                        type: 'radar',
                        data: {
                            labels: ['접근성', '친절도', '상담 품질', '사생활 보호', '대기 시간'],
                            datasets: [{
                                label: '현재 수준',
                                data: [65, 70, 75, 80, 60],
                                borderColor: '#69b7a4',
                                backgroundColor: 'rgba(105, 183, 164, 0.2)'
                            }, {
                                label: '목표 수준',
                                data: [90, 90, 90, 95, 85],
                                borderColor: 'var(--secondary-brown)',
                                backgroundColor: 'rgba(160, 82, 45, 0.1)',
                                borderDash: [5, 5]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    });
                    break;

                case 9: // 남성 참여 (원래 case 13) (원래 case 13)
                    createChart('maleInvolvement', {
                        type: 'bar',
                        data: {
                            labels: ['참여 전', '참여 후'],
                            datasets: [{
                                label: '피임 사용률 (%)',
                                data: [35, 62],
                                backgroundColor: ['#c4a977', '#69b7a4']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                    break;

                case 14: // 자금 조달 슬라이드 (Slide 15)
                    createChart('fundingTrendsMain', {
                        type: 'line',
                        data: {
                            labels: ['2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023'],
                            datasets: [
                                {
                                    label: '필요 자금',
                                    data: [9.5, 9.8, 10.2, 10.6, 11.1, 11.5, 11.9, 12.1, 12.0],
                                    borderColor: '#dc2626',
                                    backgroundColor: 'rgba(220, 38, 38, 0.1)',
                                    borderWidth: 3,
                                    borderDash: [5, 5],
                                    tension: 0.4,
                                    fill: true
                                },
                                {
                                    label: '실제 자금',
                                    data: [7.2, 7.3, 7.5, 7.4, 7.8, 7.6, 7.9, 8.1, 8.0],
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    borderWidth: 3,
                                    tension: 0.4,
                                    fill: true
                                },
                                {
                                    label: '자금 격차',
                                    data: [2.3, 2.5, 2.7, 3.2, 3.3, 3.9, 4.0, 4.0, 4.0],
                                    borderColor: '#f59e0b',
                                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                    borderWidth: 2,
                                    tension: 0.4,
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top',
                                    labels: {
                                        font: { size: 14 },
                                        padding: 15
                                    }
                                },
                                title: {
                                    display: true,
                                    text: '가족계획 글로벌 자금 동향 (십억 달러)',
                                    font: { size: 18 }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.dataset.label + ': $' + context.parsed.y.toFixed(1) + 'B';
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    min: 0,
                                    max: 14,
                                    title: {
                                        display: true,
                                        text: '십억 달러 (USD)',
                                        font: { size: 14 }
                                    },
                                    grid: {
                                        color: 'rgba(200, 200, 200, 0.3)'
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: '연도',
                                        font: { size: 14 }
                                    },
                                    grid: {
                                        color: 'rgba(200, 200, 200, 0.3)'
                                    }
                                }
                            }
                        }
                    });
                    break;

                case 8: // 피임법 공급원 지도 (Slide 9) - Figure 6 정확한 데이터
                    // Figure 6 데이터 기반 국가별 피임약(Pills) 공급원
                    const supplyData = {
                        // 사하라이남 아프리카 (Figure 6 Pills 섹션)
                        'Zimbabwe': { pharmacy: 5, community: 2, clinic: 93 },
                        'South Africa': { pharmacy: 10, community: 5, clinic: 85 },
                        'Kenya': { pharmacy: 20, community: 5, clinic: 75 },
                        'Zambia': { pharmacy: 12, community: 8, clinic: 80 },
                        'Namibia': { pharmacy: 20, community: 10, clinic: 70 },
                        'Ghana': { pharmacy: 25, community: 15, clinic: 60 },
                        'Côte d\'Ivoire': { pharmacy: 35, community: 15, clinic: 50 },
                        'Cameroon': { pharmacy: 30, community: 10, clinic: 60 },
                        'Guinea': { pharmacy: 15, community: 5, clinic: 80 },
                        'Madagascar': { pharmacy: 15, community: 10, clinic: 75 },
                        'Ethiopia': { pharmacy: 8, community: 12, clinic: 80 },
                        'Burkina Faso': { pharmacy: 10, community: 15, clinic: 75 },
                        'Malawi': { pharmacy: 5, community: 5, clinic: 90 },
                        'Uganda': { pharmacy: 10, community: 8, clinic: 82 },
                        'Mali': { pharmacy: 8, community: 10, clinic: 82 },
                        'Niger': { pharmacy: 5, community: 3, clinic: 92 },
                        'Senegal': { pharmacy: 12, community: 8, clinic: 80 },
                        'Gabon': { pharmacy: 25, community: 5, clinic: 70 },
                        'Mozambique': { pharmacy: 8, community: 7, clinic: 85 },

                        // 라틴아메리카 (Figure 6 Pills 섹션)
                        'Haiti': { pharmacy: 42, community: 18, clinic: 40 },
                        'Bolivia': { pharmacy: 48, community: 12, clinic: 40 },
                        'Guatemala': { pharmacy: 45, community: 10, clinic: 45 },
                        'Peru': { pharmacy: 55, community: 8, clinic: 37 },
                        'Colombia': { pharmacy: 65, community: 10, clinic: 25 },
                        'Nicaragua': { pharmacy: 60, community: 5, clinic: 35 },
                        'Dominican Republic': { pharmacy: 58, community: 7, clinic: 35 },
                        'Brazil': { pharmacy: 75, community: 5, clinic: 20 },

                        // 남/동남/동아시아 (Figure 6 Pills 섹션)
                        'Bangladesh': { pharmacy: 45, community: 20, clinic: 35 },
                        'Vietnam': { pharmacy: 40, community: 5, clinic: 55 },
                        'Philippines': { pharmacy: 48, community: 10, clinic: 42 },
                        'Indonesia': { pharmacy: 52, community: 8, clinic: 40 },
                        'India': { pharmacy: 38, community: 12, clinic: 50 },
                        'Nepal': { pharmacy: 35, community: 25, clinic: 40 },

                        // 북아프리카/중동 (Figure 6 Pills 섹션)
                        'Egypt': { pharmacy: 68, community: 2, clinic: 30 },
                        'Morocco': { pharmacy: 72, community: 3, clinic: 25 },
                        'Turkey': { pharmacy: 78, community: 2, clinic: 20 }
                    };

                    // 지도 초기화
                    if (!window.supplyMap) {
                        window.supplyMap = L.map('contraceptiveSupplyMap').setView([0, 0], 2);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '© OpenStreetMap contributors'
                        }).addTo(window.supplyMap);
                    }

                    // 국가별 좌표 (확장됨)
                    const countryCoordinates = {
                        // 사하라이남 아프리카
                        'Zimbabwe': [-20.0, 30.0], 'South Africa': [-29.0, 24.0],
                        'Kenya': [0.0236, 37.9062], 'Zambia': [-13.1339, 27.8493],
                        'Namibia': [-22.5609, 17.0658], 'Ghana': [7.9465, -1.0232],
                        'Côte d\'Ivoire': [7.5400, -5.5471], 'Cameroon': [7.3697, 12.3547],
                        'Guinea': [9.9456, -9.6966], 'Madagascar': [-18.7669, 46.8691],
                        'Ethiopia': [9.1450, 40.4897], 'Burkina Faso': [12.2383, -1.5616],
                        'Malawi': [-13.2543, 34.3015], 'Uganda': [1.3733, 32.2903],
                        'Mali': [17.5707, -3.9962], 'Niger': [17.6078, 8.0817],
                        'Senegal': [14.4974, -14.4524], 'Gabon': [-0.8037, 11.6094],
                        'Mozambique': [-18.6657, 35.5296],
                        // 라틴아메리카
                        'Haiti': [18.9712, -72.2852], 'Bolivia': [-16.2902, -63.5887],
                        'Guatemala': [15.7835, -90.2308], 'Peru': [-9.1900, -75.0152],
                        'Colombia': [4.5709, -74.2973], 'Nicaragua': [12.8654, -85.2072],
                        'Dominican Republic': [18.7357, -70.1627], 'Brazil': [-14.235, -51.9253],
                        // 아시아
                        'Bangladesh': [23.685, 90.3563], 'Vietnam': [14.0583, 108.2772],
                        'Philippines': [12.8797, 121.7740], 'Indonesia': [-0.7893, 113.9213],
                        'India': [20.5937, 78.9629], 'Nepal': [28.3949, 84.1240],
                        // 북아프리카/중동
                        'Egypt': [26.8206, 30.8025], 'Morocco': [31.7917, -7.0926],
                        'Turkey': [38.9637, 35.2433]
                    };

                    // 지도에 마커 추가 (크기와 색상으로 공급원 표현)
                    Object.keys(supplyData).forEach(country => {
                        if (countryCoordinates[country]) {
                            const data = supplyData[country];
                            const total = data.pharmacy + data.clinic + data.community;

                            // 주요 공급원 판별
                            let mainSource = 'clinic';
                            let color = '#2D5F5D'; // 클리닉
                            if (data.pharmacy >= data.clinic && data.pharmacy >= data.community) {
                                mainSource = 'pharmacy';
                                color = '#69b7a4'; // 약국
                            } else if (data.community >= data.clinic && data.community >= data.pharmacy) {
                                mainSource = 'community';
                                color = '#D4A574'; // 지역사회
                            }

                            // 마커 크기 (주요 공급원 비율에 비례)
                            const maxRadius = Math.max(data.pharmacy, data.clinic, data.community);
                            const radius = 4 + (maxRadius / 100) * 12;

                            L.circleMarker(countryCoordinates[country], {
                                radius: radius,
                                fillColor: color,
                                color: '#2D5F5D',
                                weight: 2,
                                opacity: 1,
                                fillOpacity: 0.7
                            }).addTo(window.supplyMap)
                            .bindPopup(`<strong style="font-size: 14px;">${country}</strong><br>
                                <div style="margin-top: 5px;">
                                <span style="color: #69b7a4;">\u25cf</span> 약국/상점: <strong>${data.pharmacy}%</strong><br>
                                <span style="color: #2D5F5D;">\u25cf</span> 클리닉: <strong>${data.clinic}%</strong><br>
                                <span style="color: #D4A574;">\u25cf</span> 지역사회: <strong>${data.community}%</strong>
                                </div>`);
                        }
                    });

                    // 레전드 추가
                    const legend = L.control({position: 'bottomright'});
                    legend.onAdd = function() {
                        const div = L.DomUtil.create('div', 'info legend');
                        div.innerHTML = `
                            <div style="background: white; padding: 10px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                                <strong style="display: block; margin-bottom: 5px;">공급원 유형</strong>
                                <div style="font-size: 12px;">
                                    <span style="color: #69b7a4; font-size: 16px;">\u25cf</span> 약국/상점 우세<br>
                                    <span style="color: #2D5F5D; font-size: 16px;">\u25cf</span> 클리닉 우세<br>
                                    <span style="color: #D4A574; font-size: 16px;">\u25cf</span> 지역사회 우세
                                </div>
                            </div>
                        `;
                        return div;
                    };
                    legend.addTo(window.supplyMap);

                    // 차트 생성 (Figure 6 정확한 데이터)
                    const ctx = document.getElementById('supplySourceChart');
                    if (ctx) {
                        new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: ['사하라이남', '라틴아메리카', '남아시아', '동남아시아', '북아프리카'],
                                datasets: [
                                    {
                                        label: '클리닉',
                                        data: [75, 33, 42, 44, 25],
                                        backgroundColor: '#2D5F5D'
                                    },
                                    {
                                        label: '약국/상점',
                                        data: [15, 57, 40, 47, 71],
                                        backgroundColor: '#69b7a4'
                                    },
                                    {
                                        label: '지역사회',
                                        data: [10, 10, 18, 9, 4],
                                        backgroundColor: '#D4A574'
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    x: { stacked: true },
                                    y: {
                                        stacked: true,
                                        max: 100,
                                        ticks: {
                                            callback: function(value) {
                                                return value + '%';
                                            }
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        position: 'bottom'
                                    },
                                    title: {
                                        display: true,
                                        text: '지역별 피임약 공급원 비율 (%)',
                                        font: { size: 16 }
                                    }
                                }
                            }
                        });
                    }

                    // Table 3 기반 효과성 사용률 차트
                    const effectivenessCtx = document.getElementById('methodEffectivenessChart');
                    if (effectivenessCtx) {
                        new Chart(effectivenessCtx, {
                            type: 'doughnut',
                            data: {
                                labels: ['가장 효과적(>99%)', '효과적', '덜 효과적'],
                                datasets: [{
                                    data: [45, 35, 20],
                                    backgroundColor: ['#2D5F5D', '#8B6F47', '#D4A574'],
                                    borderWidth: 2,
                                    borderColor: '#ffffff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            padding: 8,
                                            font: { size: 11 }
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return context.label + ': ' + context.parsed + '%';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                    break;

                case 15: // 글로벌 우선순위 인포그래픽 (Slide 16)
                    // 인포그래픽 슬라이드는 차트가 없음 - 순수 CSS로 구현
                    break;

                case 16: // 핵심 메시지 (Slide 17)
                    // 핵심 메시지 슬라이드는 차트가 없음
                    break;
            }
        }

        // 초기 로드
        window.addEventListener('load', () => {
            createPageCounter();
            showSlide(0);
        });

        // 클릭 네비게이션 (좌우 영역)
        document.addEventListener('click', (e) => {
            const viewport = document.querySelector('.presentation-viewport');
            if (!viewport.contains(e.target)) return;

            const rect = viewport.getBoundingClientRect();
            const x = e.clientX - rect.left;

            if (x < rect.width * 0.3) {
                showSlide(currentSlide - 1);
            } else if (x > rect.width * 0.7) {
                showSlide(currentSlide + 1);
            }
        });

        // PDF 내보내기 기능
        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const button = document.querySelector('.pdf-export-btn');
            const progress = document.getElementById('pdfProgress');
            const progressText = document.getElementById('pdfProgressText');
            const progressFill = document.getElementById('pdfProgressFill');

            // 버튼 비활성화 및 진행 상태 표시
            button.disabled = true;
            progress.classList.add('active');

            try {
                // PDF 생성 (A4 가로 방향)
                const pdf = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });

                const totalSlidesToExport = totalSlides;
                const originalSlide = currentSlide;

                // 각 슬라이드를 순차적으로 캡처
                for (let i = 0; i < totalSlidesToExport; i++) {
                    // 진행 상태 업데이트
                    const progressPercent = ((i + 1) / totalSlidesToExport) * 100;
                    progressText.textContent = `슬라이드 ${i + 1} / ${totalSlidesToExport} 처리 중...`;
                    progressFill.style.width = progressPercent + '%';

                    // 슬라이드 표시
                    showSlide(i);

                    // 차트나 지도가 로드될 시간을 줌
                    await new Promise(resolve => setTimeout(resolve, 500));

                    // 현재 슬라이드 캡처
                    const slideElement = slides[i];

                    // html2canvas로 슬라이드 캡처
                    const canvas = await html2canvas(slideElement, {
                        scale: 2, // 고화질을 위해 2배 스케일
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#ffffff'
                    });

                    // 캔버스를 이미지로 변환
                    const imgData = canvas.toDataURL('image/jpeg', 0.95);

                    // PDF에 이미지 추가
                    if (i > 0) {
                        pdf.addPage();
                    }

                    // A4 가로 사이즈에 맞춰 이미지 배치
                    const pdfWidth = 297; // A4 가로 너비 (mm)
                    const pdfHeight = 210; // A4 가로 높이 (mm)

                    // 이미지 비율 계산
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);

                    const finalWidth = imgWidth * ratio;
                    const finalHeight = imgHeight * ratio;

                    // 중앙 정렬
                    const x = (pdfWidth - finalWidth) / 2;
                    const y = (pdfHeight - finalHeight) / 2;

                    pdf.addImage(imgData, 'JPEG', x, y, finalWidth, finalHeight);

                    // 슬라이드 번호 추가 (우측 하단)
                    pdf.setFontSize(10);
                    pdf.setTextColor(100, 100, 100);
                    pdf.text(`${i + 1} / ${totalSlidesToExport}`, pdfWidth - 20, pdfHeight - 10);
                }

                // PDF 저장
                progressText.textContent = 'PDF 파일 생성 완료!';
                pdf.save('가족계획_미완의_과제_발표자료.pdf');

                // 원래 슬라이드로 복귀
                showSlide(originalSlide);

                // 2초 후 진행 상태 숨김
                setTimeout(() => {
                    progress.classList.remove('active');
                    button.disabled = false;
                    progressFill.style.width = '0%';
                }, 2000);

            } catch (error) {
                console.error('PDF 생성 중 오류 발생:', error);
                alert('PDF 생성 중 오류가 발생했습니다. 다시 시도해주세요.');

                // 에러 발생 시 복구
                progress.classList.remove('active');
                button.disabled = false;
                progressFill.style.width = '0%';
                showSlide(originalSlide);
            }
        }
    </script>
</body>
</html><!-- Last updated: Wed, Sep 24, 2025  1:36:07 PM -->
