<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Planning: The Unfinished Agenda - 15장 핵심 발표</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/slides.css">
    <link rel="stylesheet" href="css/visualizations.css">
    <link rel="stylesheet" href="css/responsive.css">

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>

    <!-- Leaflet for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .slide {
            display: none;
            width: 100%;
            height: 100vh;
            overflow: auto;
        }
        .slide.active {
            display: block;
        }
        .navigation {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            z-index: 1000;
        }
        .navigation button {
            margin: 0 10px;
            padding: 8px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .navigation button:hover {
            background: #0056b3;
        }
        .slide-counter {
            color: white;
            margin: 0 20px;
        }
    </style>
</head>
<body>
    <div id="presentationContainer">
        <!-- Slides will be loaded here -->
    </div>

    <div class="navigation">
        <button onclick="previousSlide()">◀ 이전</button>
        <span class="slide-counter">
            <span id="currentSlide">1</span> / <span id="totalSlides">15</span>
        </span>
        <button onclick="nextSlide()">다음 ▶</button>
        <button onclick="toggleFullscreen()">전체화면</button>
    </div>

    <script>
        let currentSlide = 1;
        const totalSlides = 15;
        const slideFiles = [
            'slides/slide01-overview.html',
            'slides/slide02-introduction-panel1.html',
            'slides/slide03-population-growth-panel2.html',
            'slides/slide04-why-matters.html',
            'slides/slide05-panel3-niger.html',
            'slides/slide06-panel4-korea.html',
            'slides/slide07-unfinished-panel5.html',
            'slides/slide08-panel6-brazil.html',
            'slides/slide09-panel7-kenya.html',
            'slides/slide10-panel8-bangladesh-pakistan.html',
            'slides/slide11-comparison.html',
            'slides/slide12-table3-methods.html',
            'slides/slide13-figure6-access.html',
            'slides/slide14-funding.html',
            'slides/slide15-recommendations.html'
        ];

        // Load all slides
        async function loadSlides() {
            const container = document.getElementById('presentationContainer');

            for (let i = 0; i < slideFiles.length; i++) {
                try {
                    const response = await fetch(slideFiles[i]);
                    if (response.ok) {
                        const html = await response.text();

                        // Create a new slide div
                        const slide = document.createElement('div');
                        slide.classList.add('slide');
                        slide.id = `slide-${i + 1}`;
                        if (i === 0) slide.classList.add('active');

                        // Extract body content from the HTML
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        const bodyContent = doc.body ? doc.body.innerHTML : html;

                        slide.innerHTML = bodyContent;
                        container.appendChild(slide);

                        // Initialize any charts in this slide
                        initializeSlideCharts(slide);
                    }
                } catch (error) {
                    console.error(`Error loading slide ${i + 1}:`, error);
                }
            }
        }

        // Initialize charts in a slide
        function initializeSlideCharts(slide) {
            // Find all chart containers
            const chartContainers = slide.querySelectorAll('[data-chart-type]');

            chartContainers.forEach(container => {
                const chartType = container.dataset.chartType;
                const chartData = container.dataset.chartData;

                if (chartData) {
                    try {
                        const data = JSON.parse(chartData);

                        if (chartType === 'plotly') {
                            // Create Plotly chart
                            const config = { responsive: true };
                            if (data.data && data.layout) {
                                Plotly.newPlot(container, data.data, data.layout, config);
                            }
                        } else if (chartType === 'leaflet') {
                            // Create Leaflet map
                            if (!container.querySelector('.leaflet-container')) {
                                const map = L.map(container).setView([0, 0], 2);
                                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

                                if (data.markers) {
                                    data.markers.forEach(marker => {
                                        L.marker([marker.lat, marker.lng])
                                            .addTo(map)
                                            .bindPopup(marker.popup);
                                    });
                                }
                            }
                        }
                    } catch (error) {
                        console.error('Error initializing chart:', error);
                    }
                }
            });
        }

        // Navigation functions
        function showSlide(n) {
            const slides = document.querySelectorAll('.slide');

            if (n > totalSlides) currentSlide = 1;
            if (n < 1) currentSlide = totalSlides;

            slides.forEach(slide => {
                slide.classList.remove('active');
            });

            const targetSlide = document.getElementById(`slide-${currentSlide}`);
            if (targetSlide) {
                targetSlide.classList.add('active');
                initializeSlideCharts(targetSlide);
            }

            document.getElementById('currentSlide').textContent = currentSlide;
        }

        function nextSlide() {
            currentSlide++;
            showSlide(currentSlide);
        }

        function previousSlide() {
            currentSlide--;
            showSlide(currentSlide);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextSlide();
            if (e.key === 'ArrowLeft') previousSlide();
            if (e.key === 'f' || e.key === 'F') toggleFullscreen();
            if (e.key === 'Escape' && document.fullscreenElement) {
                document.exitFullscreen();
            }
        });

        // Initialize
        loadSlides();
    </script>
</body>
</html>