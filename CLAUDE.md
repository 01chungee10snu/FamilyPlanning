# Claude Code Context: Family Planning Presentation System

## Project Overview
Single-file HTML presentation system for "Family Planning: The Unfinished Agenda" (Lancet 2006) with interactive data visualizations, 20-minute timing control, and bilingual support.

## Current Feature: 003-presentation-refinements
Refining presentation with data corrections, citation formatting, UI fixes, and validation against PDF source. Previous feature 002-integrated-presentation established base structure.

## Tech Stack
- **Core**: HTML5, CSS3, JavaScript ES6 (all inline)
- **Visualization**: Chart.js 4.4.0, Leaflet.js 1.9.4 (CDN)
- **Data**: Inline JSON structures
- **Build**: None - single file delivery

## Constitutional Requirements
1. **Single-File**: Everything inline except CDN libraries
2. **Data Accuracy**: 100% fidelity to PDF source
3. **16:9 Format**: Strict aspect ratio enforcement
4. **Geographic Integration**: Time-series maps required
5. **20-Minute Scope**: 35-40 slides, auto-timed

## Project Structure
```
presentation.html          # Single deliverable file
specs/003-presentation-refinements/
├── spec.md               # 19 functional requirements for corrections
├── plan.md               # Implementation approach
├── research.md           # Citation and tooltip decisions
├── data-model.md         # Navigation and validation structures
├── contracts/            # Navigation, citation, tooltip, validation
├── quickstart.md         # Validation guide
└── tasks.md              # (Next: task list)
```

## Key Patterns

### Inline Data Structure
```javascript
window.PresentationData = {
  slides: [...],      // 35-40 slide objects
  panels: [...],      // 8 panels from paper
  visualizations: {
    charts: {...},    // Chart.js configs
    maps: {...},      // Leaflet configs
    timelines: {...}  // Custom implementations
  },
  countries: {...},   // Geographic data
  timeseries: {...}   // Temporal data
};
```

### Visualization Rendering
```javascript
// Chart.js pattern
const chart = new Chart(ctx, {
  type: 'line',
  data: PresentationData.charts[id],
  options: standardOptions
});

// Leaflet pattern
const map = L.map('map-' + id).setView(center, zoom);
L.geoJSON(data, {style: choroplethStyle}).addTo(map);
```

### Slide Timing Control
```javascript
const slideDurations = {
  simple: 30,      // seconds
  complex: 40,
  panel: 45
};
const totalTarget = 1200; // 20 minutes
```

## Data Sources
- **PDF**: "Family planning the unfinished agenda.pdf" - numerical data
- **Slides**: 60+ HTML files in slides/ folder
- **Panels**: 8 special content sections to integrate

## Quality Standards
- Data accuracy: Zero tolerance for errors
- Performance: <3s load, 60fps transitions
- Accessibility: WCAG 2.1 AA minimum
- Browser support: Chrome/Firefox/Safari/Edge 100+

## Current Phase
Phase 1 (Design) complete for 003-presentation-refinements. Ready for Phase 2 (Task Generation).

## Next Steps
1. Run `/tasks` command to generate refinement tasks
2. Implement navigation (page counter)
3. Correct data values per slide
4. Add APA citations throughout
5. Fix tooltip boundaries
6. Validate against PDF source

## Testing Focus
- Data accuracy validation against PDF
- 20-minute timing precision
- Cross-browser compatibility
- Visualization interactivity
- Navigation responsiveness

## Recent Context
- Feature 003: Presentation refinements with 19 functional requirements
- Key corrections: Niger TFR 7.5, Kenya data fixes, slide 10 removal
- Navigation enhancement: Page counter (current | total) format
- Citation system: APA format with in-text references
- UI fixes: Tooltip containment within map boundaries

---
*Auto-generated by implementation plan - manually update as needed*