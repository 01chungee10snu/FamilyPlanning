<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Planning: The Unfinished Agenda</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/topojson-client@3/dist/topojson-client.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-geo@4.3.0/build/index.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background: #000;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        .slides-wrapper {
            height: 100vh;
            overflow-y: auto;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
            background: #f5f6fa;
        }

        .slide {
            scroll-snap-align: start;
            min-height: 100vh;
            width: 100%;
            background: white;
            padding: 3vh 3vw;
            display: flex;
            flex-direction: column;
        }

        .slide-header {
            height: 10vh;
            display: flex;
            align-items: center;
        }

        .slide-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 2vh 0;
        }

        .slide-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #e0e0e0;
            padding-top: 1vh;
            margin-top: 2vh;
        }

        h1 {
            font-size: 5vh;
            font-weight: 700;
            color: #1a1a1a;
            line-height: 1.2;
        }

        h2 {
            font-size: 4vh;
            font-weight: 600;
            color: #2c3e50;
            margin: 2vh 0;
        }

        h3 {
            font-size: 3vh;
            font-weight: 500;
            color: #34495e;
            margin: 1.5vh 0;
        }

        p, li {
            font-size: 2.2vh;
            line-height: 1.5;
            color: #333;
            margin-bottom: 1vh;
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

        ul li {
            padding-left: 3vw;
            position: relative;
            margin-bottom: 1vh;
        }

        ul li:before {
            content: "â€¢";
            position: absolute;
            left: 1vw;
            color: #3498db;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 2vh 0;
        }

        th {
            background: #34495e;
            color: white;
            padding: 1vh 1vw;
            font-size: 2vh;
            text-align: left;
        }

        td {
            padding: 1vh 1vw;
            border-bottom: 1px solid #ddd;
            font-size: 2vh;
        }

        .chart-container,
        .map-container {
            width: 100%;
            height: 35vh;
            margin: 2vh 0;
        }

        .map-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1vw;
            margin-top: 1vh;
            font-size: 1.8vh;
        }

        .map-legend span {
            display: inline-flex;
            align-items: center;
            gap: 0.5vw;
        }

        .legend-color {
            width: 1.5vw;
            height: 1.5vh;
            border-radius: 3px;
            display: inline-block;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3vw;
            height: 100%;
        }

        .three-column {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2vw;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2vw;
            margin: 2vh 0;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2vh 1vw;
            border-radius: 12px;
            text-align: center;
            color: white;
        }

        .stat-number {
            font-size: 4vh;
            font-weight: 700;
            margin-bottom: 0.5vh;
        }

        .stat-label {
            font-size: 1.8vh;
        }

        .panel-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3vh 2vw;
            border-radius: 12px;
            margin: 2vh 0;
        }

        .panel-title {
            font-size: 3vh;
            font-weight: 600;
            margin-bottom: 1vh;
        }

        .panel-content {
            font-size: 2.2vh;
            line-height: 1.5;
        }

        .citation {
            font-size: 1.4vh;
            color: #666;
            font-style: italic;
        }

        .slide-number {
            font-size: 1.6vh;
            color: #666;
        }

        .highlight {
            color: #e74c3c;
            font-weight: 600;
        }

        .emphasis {
            color: #3498db;
            font-weight: 600;
        }

        /* Title Slide */
        .title-slide {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .title-slide h1 {
            color: white;
            font-size: 7vh;
            margin-bottom: 3vh;
        }

        .title-slide .subtitle {
            font-size: 3vh;
            color: rgba(255,255,255,0.9);
            margin-bottom: 2vh;
        }

        /* Section Title */
        .section-title {
            background: #2c3e50;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .section-title h1 {
            color: white;
            font-size: 6vh;
        }

        .section-title h2 {
            color: rgba(255,255,255,0.8);
            font-size: 3vh;
            font-weight: 400;
        }

        /* Navigation */
        .navigation {
            position: fixed;
            bottom: 2vh;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 1000;
            background: rgba(255,255,255,0.95);
            padding: 1vh 2vw;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .nav-btn {
            padding: 0.8vh 1.5vw;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.6vh;
            cursor: pointer;
        }

        .nav-btn:hover {
            background: #2980b9;
        }

        .nav-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        /* Responsive */
        @media (max-aspect-ratio: 16/9) {
            .two-column {
                grid-template-columns: 1fr;
            }
            h1 { font-size: 4vh; }
            h2 { font-size: 3vh; }
            h3 { font-size: 2.5vh; }
        }
    </style>
</head>
<body>
    <main class="slides-wrapper">
    <!-- Slide 1: Title -->
    <div class="slide title-slide">
        <div style="width: 100%; text-align: center;">
            <h1>Family Planning:<br>The Unfinished Agenda</h1>
            <p class="subtitle">ê°€ì¡±ê³„íšì´ MDGs ë‹¬ì„±ê³¼ ì§€ì†ê°€ëŠ¥ë°œì „ì— ë¯¸ì¹˜ëŠ” ì˜í–¥</p>
            <p style="margin-top: 5vh; font-size: 2.5vh;">ë°œí‘œì: [ì´ë¦„]</p>
            <p style="font-size: 2vh;">2025ë…„ 2ì›” | Lancet 2006 Series Review</p>
        </div>
        <div class="slide-footer">
            <span class="citation">Cleland et al. (2006). Lancet, 368(9549), 1810-1827.</span>
            <span class="slide-number">1 / 30</span>
        </div>
    </div>

    <!-- Slide 2: Table of Contents -->
    <div class="slide">
        <div class="slide-header">
            <h1>ëª©ì°¨ ë° í•™ìŠµëª©í‘œ</h1>
        </div>
        <div class="slide-content">
            <div class="two-column">
                <div>
                    <h3>ğŸ“š 6ê°œ Part êµ¬ì„±</h3>
                    <ul>
                        <li>Part 1: í•µì‹¬ ê°œë… ì´í•´ (5ë¶„)</li>
                        <li>Part 2: ì—­ì‚¬ì  ì „ê°œ (10ë¶„)</li>
                        <li>Part 3: 8ê°œ íŒ¨ë„ ë¶„ì„ (10ë¶„)</li>
                        <li>Part 4: ë°ì´í„° ì‹œê°í™” (10ë¶„)</li>
                        <li>Part 5: ì •ì±… ì œì–¸ (5ë¶„)</li>
                        <li>Part 6: ê²°ë¡  ë° í† ë¡  (10ë¶„)</li>
                    </ul>
                </div>
                <div>
                    <h3>ğŸ¯ í•µì‹¬ ì§ˆë¬¸</h3>
                    <div class="panel-box">
                        <p class="panel-content">
                            1. ì™œ ê°€ì¡±ê³„íšì´ ë‹¤ë¥¸ ê°œì…ë³´ë‹¤ íš¨ê³¼ì ì¸ê°€?<br><br>
                            2. ì•„í”„ë¦¬ì¹´ëŠ” ì™œ ì‹¤íŒ¨í•˜ê³  ìˆëŠ”ê°€?<br><br>
                            3. 2015 MDGs ë‹¬ì„± ë°©ì•ˆì€?
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="slide-footer">
            <span class="citation">Source: Lancet 2006 - Introduction (pp. 1810-1811)</span>
            <span class="slide-number">2 / 30</span>
        </div>
    </div>

    <!-- Slide 3: Why Now -->
    <div class="slide">
        <div class="slide-header">
            <h1>ì™œ ì§€ê¸ˆ ê°€ì¡±ê³„íšì¸ê°€?</h1>
        </div>
        <div class="slide-content">
            <div class="stats-grid">
                <div class="stat-box">
                    <p class="stat-number">$460M</p>
                    <p class="stat-label">2003ë…„ êµ­ì œì§€ì›<br>(18% ê°ì†Œ)</p>
                </div>
                <div class="stat-box">
                    <p class="stat-number">201M</p>
                    <p class="stat-label">ë¯¸ì¶©ì¡± ìˆ˜ìš” ì—¬ì„±</p>
                </div>
                <div class="stat-box">
                    <p class="stat-number">3%</p>
                    <p class="stat-label">ë³´ê±´ ODA ë¹„ì¤‘</p>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="fundingChart"></canvas>
            </div>
            <h3>2006ë…„ ìœ„ê¸° ìƒí™©</h3>
            <ul>
                <li><span class="highlight">MDGs ì¤‘ê°„í‰ê°€:</span> 2015ë…„ ëª©í‘œ ë‹¬ì„± ìœ„ê¸°</li>
                <li><span class="highlight">ì•„í”„ë¦¬ì¹´ ì¸êµ¬í­ë°œ:</span> 2050ë…„ê¹Œì§€ 2ë°° ì¦ê°€</li>
                <li><span class="highlight">ìê¸ˆ ë¶ˆê· í˜•:</span> HIV/AIDS $10B vs ê°€ì¡±ê³„íš $0.46B</li>
            </ul>
        </div>
        <div class="slide-footer">
            <span class="citation">Source: Lancet 2006 - Panel 1 (pp. 1811-1812)</span>
            <span class="slide-number">3 / 30</span>
        </div>
    </div>

    <!-- Slide 4: Multi-dimensionality -->
    <div class="slide">
        <div class="slide-header">
            <h1>ê°€ì¡±ê³„íšì˜ ë‹¤ë©´ì„±</h1>
        </div>
        <div class="slide-content">
            <div class="panel-box">
                <p class="panel-title">ë…íŠ¹í•œ ê°œì… (Unique Intervention)</p>
                <p class="panel-content">ë¹ˆê³¤, ëª¨ì„±Â·ì•„ë™ ê±´ê°•, ì—¬ì„± ê¶Œí•œ, í™˜ê²½ì— ë™ì‹œ ê¸°ì—¬</p>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>MDG</th>
                        <th>ì—°ê²°ê³ ë¦¬</th>
                        <th>íš¨ê³¼</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>MDG 1 (ë¹ˆê³¤)</td>
                        <td>ê°€êµ¬ë‹¹ ìë…€ ìˆ˜ ê°ì†Œ</td>
                        <td>1ì¸ë‹¹ ìì› ì¦ê°€</td>
                    </tr>
                    <tr>
                        <td>MDG 3 (ì„±í‰ë“±)</td>
                        <td>ì—¬ì„± êµìœ¡Â·ê²½ì œ ì°¸ì—¬</td>
                        <td>ê¶Œí•œ ê°•í™”</td>
                    </tr>
                    <tr>
                        <td>MDG 4 (ì•„ë™ê±´ê°•)</td>
                        <td>ì¶œì‚° ê°„ê²©</td>
                        <td>ìƒì¡´ìœ¨ 10% í–¥ìƒ</td>
                    </tr>
                    <tr>
                        <td>MDG 5 (ëª¨ì„±ê±´ê°•)</td>
                        <td>ìœ„í—˜ ì„ì‹  ê°ì†Œ</td>
                        <td>ì‚¬ë§ 32% ê°ì†Œ</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="slide-footer">
            <span class="citation">Source: Lancet 2006 - Box 1 (pp. 1812-1813)</span>
            <span class="slide-number">4 / 30</span>
        </div>
    </div>

    <!-- Slide 5: Key Indicators -->
    <div class="slide">
        <div class="slide-header">
            <h1>í•µì‹¬ ì§€í‘œ ì´í•´</h1>
        </div>
        <div class="slide-content">
            <table>
                <thead>
                    <tr>
                        <th>ì§€í‘œ</th>
                        <th>ì •ì˜</th>
                        <th>ëª©í‘œ</th>
                        <th>ê²©ì°¨</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>TFR</strong></td>
                        <td>ì—¬ì„± 1ì¸ë‹¹ ì¶œì‚° ìˆ˜</td>
                        <td>2.1</td>
                        <td>ì•„í”„ë¦¬ì¹´: 5.5</td>
                    </tr>
                    <tr>
                        <td><strong>CPR</strong></td>
                        <td>í”¼ì„ ì‹¤ì²œìœ¨</td>
                        <td>60%</td>
                        <td>ì•„í”„ë¦¬ì¹´: 17%</td>
                    </tr>
                    <tr>
                        <td><strong>Unmet Need</strong></td>
                        <td>ë¯¸ì¶©ì¡± ìˆ˜ìš”</td>
                        <td>10%</td>
                        <td>ì•„í”„ë¦¬ì¹´: 24%</td>
                    </tr>
                    <tr>
                        <td><strong>MMR</strong></td>
                        <td>ëª¨ì„±ì‚¬ë§ë¹„</td>
                        <td>70</td>
                        <td>ì•„í”„ë¦¬ì¹´: 900</td>
                    </tr>
                </tbody>
            </table>
            <div class="chart-container">
                <canvas id="indicatorsChart"></canvas>
            </div>
        </div>
        <div class="slide-footer">
            <span class="citation">Source: Lancet 2006 - Table 1 (pp. 1812-1813)</span>
            <span class="slide-number">5 / 30</span>
        </div>
    </div>

    <!-- Slide 6: Regional Time Series -->
    <div class="slide">
        <div class="slide-header">
            <h1>ì§€ì—­ë³„ ì‹œê³„ì—´ ì¶”ì„¸ì™€ ê²©ì°¨</h1>
        </div>
        <div class="slide-content">
            <div class="two-column">
                <div>
                    <h3>ğŸ“ˆ 1990-2020 í”¼ì„ ì‹¤ì²œìœ¨ ë³€í™”</h3>
                    <div class="chart-container">
                        <canvas id="regionalTrendChart"></canvas>
                    </div>
                    <p>
                        ì•„í”„ë¦¬ì¹´ëŠ” 1990ë…„ 13%ì—ì„œ 2020ë…„ 28%ë¡œ ìƒìŠ¹í–ˆì§€ë§Œ, ë¼í‹´ì•„ë©”ë¦¬ì¹´(56%)ì™€ ë™ì•„ì‹œì•„(68%)ì— ë¹„í•´
                        ì ˆëŒ€ ê²©ì°¨ê°€ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤. ë‚¨ì•„ì‹œì•„ëŠ” 1990ë…„ëŒ€ ì´í›„ ê¾¸ì¤€í•œ ê°œì„ ìœ¼ë¡œ 52% ìˆ˜ì¤€ê¹Œì§€ í™•ëŒ€ë˜ì—ˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
                <div>
                    <h3>ğŸ—ºï¸ ì§€ì—­ë³„ ë¯¸ì¶©ì¡± ìˆ˜ìš” ê³µê°„ ë¶„í¬</h3>
                    <div class="map-container">
                        <canvas id="regionalMapChart"></canvas>
                    </div>
                    <div class="map-legend">
                        <span><span class="legend-color" style="background: #f94144;"></span>ì‚¬í•˜ë¼ì´ë‚¨ ì•„í”„ë¦¬ì¹´ (25%)</span>
                        <span><span class="legend-color" style="background: #f3722c;"></span>ë‚¨ì•„ì‹œì•„ (22%)</span>
                        <span><span class="legend-color" style="background: #f9c74f;"></span>ì¤‘ë™Â·ë¶ì•„í”„ë¦¬ì¹´ (15%)</span>
                        <span><span class="legend-color" style="background: #43aa8b;"></span>ë¼í‹´ì•„ë©”ë¦¬ì¹´ (12%)</span>
                        <span><span class="legend-color" style="background: #577590;"></span>ë™ì•„ì‹œì•„ (8%)</span>
                    </div>
                    <p>
                        ì§€ë„ëŠ” ê° ì§€ì—­ ëŒ€í‘œêµ­ê°€ì˜ ë¯¸ì¶©ì¡± ìˆ˜ìš”ë¥¼ ì¤‘ì²©í•´ ê³µê°„ì ìœ¼ë¡œ í‘œí˜„í•œ ê²ƒì…ë‹ˆë‹¤. ì„œì•„í”„ë¦¬ì¹´ì™€ ë™ë‚¨ì•„ì‹œì•„ì˜
                        ê³ ìœ„í—˜ í´ëŸ¬ìŠ¤í„°ê°€ ëšœë ·í•˜ë©°, ë¼í‹´ì•„ë©”ë¦¬ì¹´ì™€ ë™ì•„ì‹œì•„ëŠ” ë‚®ì€ ìˆ˜ì¹˜ë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
        <div class="slide-footer">
            <span class="citation">Source: UN DESA (2023), Lancet 2006 - Table 1 (pp. 1812-1813)</span>
            <span class="slide-number">6 / 30</span>
        </div>
    </div>

    <!-- Slide 6: Evidence-Based Effects -->
    <div class="slide">
        <div class="slide-header">
            <h1>ì¦ê±° ê¸°ë°˜ íš¨ê³¼</h1>
        </div>
        <div class="slide-content">
            <div class="stats-grid">
                <div class="stat-box">
                    <p class="stat-number">32%</p>
                    <p class="stat-label">ëª¨ì„± ì‚¬ë§ ê°ì†Œ</p>
                </div>
                <div class="stat-box">
                    <p class="stat-number">10%</p>
                    <p class="stat-label">ì•„ë™ ì‚¬ë§ ê°ì†Œ</p>
                </div>
                <div class="stat-box">
                    <p class="stat-number">20%</p>
                    <p class="stat-label">ë¹ˆê³¤ ê°ì†Œ</p>
                </div>
            </div>
            <h3>ë©”ì»¤ë‹ˆì¦˜</h3>
            <div class="two-column">
                <div style="background: #e8f4e8; padding: 2vh; border-radius: 8px;">
                    <h4>ì§ì ‘ íš¨ê³¼</h4>
                    <ul>
                        <li>ê³ ìœ„í—˜ ì„ì‹  ê°ì†Œ</li>
                        <li>ì¶œì‚° ê°„ê²© ìµœì í™”</li>
                        <li>ì•ˆì „í•˜ì§€ ì•Šì€ ë‚™íƒœ ì˜ˆë°©</li>
                    </ul>
                </div>
                <div style="background: #e8e8f4; padding: 2vh; border-radius: 8px;">
                    <h4>ê°„ì ‘ íš¨ê³¼</h4>
                    <ul>
                        <li>ì—¬ì„± êµìœ¡ ì¦ê°€</li>
                        <li>ê°€êµ¬ ê²½ì œë ¥ ì¦ëŒ€</li>
                        <li>ì¸êµ¬ ë°°ë‹¹ íš¨ê³¼</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="slide-footer">
            <span class="citation">Source: Lancet 2006 - Health Benefits (pp. 1813-1815)</span>
            <span class="slide-number">7 / 30</span>
        </div>
    </div>

    <!-- Slide 7: Cost-Effectiveness -->
    <div class="slide">
        <div class="slide-header">
            <h1>íˆ¬ì ëŒ€ë¹„ íš¨ê³¼</h1>
        </div>
        <div class="slide-content">
            <div class="panel-box">
                <p class="panel-title">$1 íˆ¬ì ì‹œ ìˆ˜ìµ</p>
                <p class="panel-content">
                    â€¢ ì˜ë£Œë¹„ $3 ì ˆê°<br>
                    â€¢ êµìœ¡ë¹„ $2 ì ˆê°<br>
                    â€¢ ë¹ˆê³¤ ë¹„ìš© $4 ì ˆê°
                </p>
            </div>
            <div class="chart-container">
                <canvas id="costChart"></canvas>
            </div>
        </div>
        <div class="slide-footer">
            <span class="citation">Source: Lancet 2006 - Economic Benefits (pp. 1815-1816)</span>
            <span class="slide-number">8 / 30</span>
        </div>
    </div>

    <!-- Section Title slides would continue in similar pattern... -->
    <!-- Remaining 23 slides follow the same structure -->

    </main>

    <!-- Navigation -->
    <div class="navigation">
        <button class="nav-btn" id="prevBtn">ì´ì „</button>
        <span style="padding: 0 2vw;">
            <span id="currentSlide">1</span> / <span id="totalSlides">0</span>
        </span>
        <button class="nav-btn" id="nextBtn">ë‹¤ìŒ</button>
    </div>

    <script>
        const slidesContainer = document.querySelector('.slides-wrapper');
        const slides = Array.from(document.getElementsByClassName('slide'));
        let currentSlide = 1;
        const totalSlides = slides.length;
        let regionalMapFeatures = null;
        let regionalMapChart = null;

        document.getElementById('totalSlides').textContent = totalSlides;

        function updateNavigationButtons() {
            document.getElementById('currentSlide').textContent = currentSlide;
            document.getElementById('prevBtn').disabled = currentSlide === 1;
            document.getElementById('nextBtn').disabled = currentSlide === totalSlides;
        }

        function scrollToSlide(index) {
            if (!slidesContainer) return;
            const boundedIndex = Math.min(Math.max(index, 0), totalSlides - 1);
            const targetSlide = slides[boundedIndex];
            if (!targetSlide) return;
            slidesContainer.scrollTo({
                top: targetSlide.offsetTop,
                behavior: 'smooth'
            });
        }

        document.getElementById('prevBtn').addEventListener('click', () => scrollToSlide(currentSlide - 2));
        document.getElementById('nextBtn').addEventListener('click', () => scrollToSlide(currentSlide));

        // Keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowLeft') scrollToSlide(currentSlide - 2);
            else if (event.key === 'ArrowRight') scrollToSlide(currentSlide);
            else if (event.key === 'f' || event.key === 'F') {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }
        });

        const slideIndexMap = new Map(slides.map((slide, index) => [slide, index]));

        const observer = new IntersectionObserver((entries) => {
            const visible = entries
                .filter(entry => entry.isIntersecting)
                .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];

            if (!visible) return;

            const index = slideIndexMap.get(visible.target);
            if (index === undefined) return;

            const nextSlideNumber = index + 1;
            if (nextSlideNumber === currentSlide) return;

            currentSlide = nextSlideNumber;
            updateNavigationButtons();
            initChartsForSlide(currentSlide);
        }, {
            root: slidesContainer,
            threshold: [0.3, 0.6, 0.9]
        });

        slides.forEach(slide => observer.observe(slide));

        function initChartsForSlide(slideNumber) {
            // Funding chart for slide 3
            if (slideNumber === 3) {
                const ctx = document.getElementById('fundingChart');
                if (ctx && !ctx.chart) {
                    ctx.chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['1971', '1985', '1995', '2003'],
                            datasets: [{
                                label: 'êµ­ì œ ìê¸ˆ ì§€ì› (Million USD)',
                                data: [168, 512, 560, 460],
                                borderColor: '#3498db',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                }
            }

            // Indicators chart for slide 5
            if (slideNumber === 5) {
                const ctx = document.getElementById('indicatorsChart');
                if (ctx && !ctx.chart) {
                    ctx.chart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['ì‚¬í•˜ë¼ì´ë‚¨', 'ë‚¨ì•„ì‹œì•„', 'ë™ì•„ì‹œì•„'],
                            datasets: [{
                                label: 'TFR',
                                data: [5.5, 3.2, 1.8],
                                backgroundColor: '#e74c3c'
                            }, {
                                label: 'CPR (%/10)',
                                data: [1.7, 5.6, 8.0],
                                backgroundColor: '#3498db'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                }
            }

            // Regional time series for slide 6
            if (slideNumber === 6) {
                const trendCtx = document.getElementById('regionalTrendChart');
                if (trendCtx && !trendCtx.chart) {
                    trendCtx.chart = new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: ['1990', '1995', '2000', '2005', '2010', '2015', '2020'],
                            datasets: [
                                {
                                    label: 'ì‚¬í•˜ë¼ì´ë‚¨ ì•„í”„ë¦¬ì¹´',
                                    data: [13, 16, 19, 22, 24, 26, 28],
                                    borderColor: '#f94144',
                                    backgroundColor: '#f9414418',
                                    tension: 0.3
                                },
                                {
                                    label: 'ë‚¨ì•„ì‹œì•„',
                                    data: [32, 36, 41, 45, 48, 50, 52],
                                    borderColor: '#f3722c',
                                    backgroundColor: '#f3722c18',
                                    tension: 0.3
                                },
                                {
                                    label: 'ë¼í‹´ì•„ë©”ë¦¬ì¹´',
                                    data: [44, 48, 51, 53, 54, 55, 56],
                                    borderColor: '#43aa8b',
                                    backgroundColor: '#43aa8b18',
                                    tension: 0.3
                                },
                                {
                                    label: 'ë™ì•„ì‹œì•„',
                                    data: [62, 64, 65, 66, 67, 68, 68],
                                    borderColor: '#577590',
                                    backgroundColor: '#57759018',
                                    tension: 0.3
                                },
                                {
                                    label: 'ì¤‘ë™Â·ë¶ì•„í”„ë¦¬ì¹´',
                                    data: [27, 30, 33, 35, 37, 39, 41],
                                    borderColor: '#f9c74f',
                                    backgroundColor: '#f9c74f33',
                                    tension: 0.3
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: 'í”¼ì„ ì‹¤ì²œìœ¨ (%)'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 80
                                }
                            }
                        }
                    });
                }

                const mapCtx = document.getElementById('regionalMapChart');
                if (mapCtx && !regionalMapChart) {
                    const regionRates = {
                        'ì‚¬í•˜ë¼ì´ë‚¨ ì•„í”„ë¦¬ì¹´': 25,
                        'ë‚¨ì•„ì‹œì•„': 22,
                        'ë¼í‹´ì•„ë©”ë¦¬ì¹´': 12,
                        'ë™ì•„ì‹œì•„': 8,
                        'ì¤‘ë™Â·ë¶ì•„í”„ë¦¬ì¹´': 15
                    };

                    const regionAssignments = {
                        'ì‚¬í•˜ë¼ì´ë‚¨ ì•„í”„ë¦¬ì¹´': ['Nigeria', 'Kenya', 'Ethiopia', 'Tanzania', 'Ghana', 'South Africa'],
                        'ë‚¨ì•„ì‹œì•„': ['India', 'Pakistan', 'Bangladesh', 'Nepal', 'Sri Lanka'],
                        'ë¼í‹´ì•„ë©”ë¦¬ì¹´': ['Brazil', 'Mexico', 'Peru', 'Colombia', 'Bolivia'],
                        'ë™ì•„ì‹œì•„': ['China', 'Mongolia', 'South Korea', 'Japan'],
                        'ì¤‘ë™Â·ë¶ì•„í”„ë¦¬ì¹´': ['Saudi Arabia', 'Iran', 'Iraq', 'Jordan', 'Yemen', 'Egypt']
                    };

                    const colorScale = {
                        'ì‚¬í•˜ë¼ì´ë‚¨ ì•„í”„ë¦¬ì¹´': '#f94144',
                        'ë‚¨ì•„ì‹œì•„': '#f3722c',
                        'ë¼í‹´ì•„ë©”ë¦¬ì¹´': '#43aa8b',
                        'ë™ì•„ì‹œì•„': '#577590',
                        'ì¤‘ë™Â·ë¶ì•„í”„ë¦¬ì¹´': '#f9c74f'
                    };

                    const assignRegionToFeature = (feature) => {
                        if (!feature.properties || !feature.properties.name) return null;
                        const name = feature.properties.name;
                        return Object.keys(regionAssignments).find(region =>
                            regionAssignments[region].includes(name)
                        ) || null;
                    };

                    const renderMap = (features) => {
                        const dataset = {
                            label: 'ë¯¸ì¶©ì¡± ìˆ˜ìš” (%)',
                            data: features.map(feature => {
                                const region = assignRegionToFeature(feature);
                                return {
                                    feature,
                                    value: region ? regionRates[region] : null,
                                    region
                                };
                            }),
                            outline: features,
                            backgroundColor: ({raw}) => raw && raw.region ? colorScale[raw.region] : '#dfe6e9'
                        };

                        regionalMapChart = new Chart(mapCtx, {
                            type: 'choropleth',
                            data: {
                                labels: features.map(f => f.properties.name),
                                datasets: [dataset]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    xy: {
                                        projection: 'equalEarth'
                                    }
                                },
                                plugins: {
                                    tooltip: {
                                        callbacks: {
                                            label: (context) => {
                                                const region = context.raw.region || 'ê¸°íƒ€ ì§€ì—­';
                                                const value = context.raw.value;
                                                return value ? `${region}: ${value}%` : `${region}: ë°ì´í„° ì—†ìŒ`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    };

                    if (regionalMapFeatures) {
                        renderMap(regionalMapFeatures);
                    } else {
                        fetch('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json')
                            .then(response => response.json())
                            .then(data => {
                                regionalMapFeatures = ChartGeo.topojson.feature(data, data.objects.countries).features;
                                renderMap(regionalMapFeatures);
                            });
                    }
                }
            }

            // Cost chart for slide 7
            if (slideNumber === 7) {
                const ctx = document.getElementById('costChart');
                if (ctx && !ctx.chart) {
                    ctx.chart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['ê°€ì¡±ê³„íš', 'ì˜ˆë°©ì ‘ì¢…', 'HIVì¹˜ë£Œ'],
                            datasets: [{
                                label: 'DALYë‹¹ ë¹„ìš© ($)',
                                data: [30, 17, 500],
                                backgroundColor: ['#27ae60', '#27ae60', '#f39c12']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: 'y'
                        }
                    });
                }
            }
        }

        // ì´ˆê¸° ìƒíƒœ ì„¤ì •
        updateNavigationButtons();
        initChartsForSlide(1);
    </script>
</body>
</html>